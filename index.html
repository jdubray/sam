<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>SAM - State | Action | Model</title>

    <!-- Styles -->
    <link href="assets/css/theDocs.all.min.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
    <link href="assets/css/chat.css" rel="stylesheet">
    
    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Raleway:100,300,400,500%7CLato:300,400' rel='stylesheet' type='text/css'>

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="assets/img/favicon.ico">
    
  </head>

  <body>
    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <header class="site-header">

      <!-- Top navbar & branding -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">

          <!-- Toggle buttons and brand -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar">
              <span class="glyphicon glyphicon-option-vertical"></span>
            </button>

            <button type="button" class="navbar-toggle for-sidebar" data-toggle="offcanvas">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="index.html"><img src="assets/img/logo.png" alt="logo"></a>
          </div>
          <!-- END Toggle buttons and brand -->

          <!-- Top navbar -->
          <div id="navbar" class="navbar-collapse collapse" aria-expanded="true" role="banner">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://gitter.im/jdubray/sam" target="_blank">Support</a></li>
              <li class="hero"><a href="http://xgenio.com/contact-xgenio/">Contact us</a></li>
              <li><a href="http://twitter.com/metapgmr"><i class="fa fa-twitter"></i></a></li>
              <li><a href="http://www.ebpml.org/blog15/feed/"><i class="fa fa-rss"></i></a></li>
            </ul>
          </div>
          <!-- END Top navbar -->

        </div>
      </nav>
      <!-- END Top navbar & branding -->
      
    </header>


    <main class="container-fluid">
      <div class="row">

        <!-- Sidebar -->
        <aside class="col-lg-2 col-md-3 col-sm-3 sidebar">

          <ul class="sidenav dropable sticky">
            <li><a href="#">Overview</a></li>
            <li>
              <a class="active" href="#">Topics</a>
              <ul>
                <li><a href="#actions">Actions</a></li>
                <li><a href="#model">Model</a></li>
                <li><a href="#state">State</a></li>
                <li><a href="#sr">State Representation</a></li>
                <li><a href="#wiring">Wiring</a></li>
                <li><a href="#timetravel">Time Travel</a></li>
              </ul>
            </li>
            
            <li>
              <a href="#">Advanced Topics</a>
              <ul>
                <li><a href="#container">Micro Container</a></li>
                <li><a href="#comp">Composition</a></li>
                <li><a href="#sm">State Machines</a></li>
                <li><a href="#apis">APIs</a></li>
                <li><a href="#headless">Headless SAM</a></li>
                <li><a href="#iso">Isomorphic JavaScript</a></li>
                <li><a href="#conc">Concurrency</a></li>
              </ul>
            </li>

            <li>
              <a href="#samples">Code Samples</a>
              <ul>
                <li><a href="#rocket">Rocket Launcher</a></li>
                <li><a href="#rocketreact">SAM+Redux</a></li>
                <li><a href="#listsample">List Manager</a></li>
                <li><a href="#nodesample">Node.js</a></li>
                <li><a href="#othersamples">Others</a></li>
              </ul>
            </li>

            <li>
              <a href="#">Frameworks</a>
              <ul>
                <li><a href="#react">React</a></li>
                <li><a href="#ng">Angular</a></li>
                <li><a href="#vue">Vue</a></li>
                <li><a href="#meiosis">Meiosis</a></li>
              </ul>
            </li>

            <li>
              <a href="#">News</a>
              <ul>
                <li><a href="https://www.infoq.com/jp/articles/no-more-mvc-frameworks">Japanese Translation</a></li>
                <li><a href="https://www.youtube.com/watch?v=lMgSS_b98S8">10 min Introduction</a></li>
              </ul>
            </li>
            <li><a href="#references">References</a></li>
            <!-- li><a href="#who">Who is using SAM?</a></li -->
          </ul>

        </aside>
        <!-- END Sidebar -->


        <!-- Main content -->
        <article class="col-lg-10 col-md-9 col-sm-9 main-content" role="main">
          
          <header>
            <h1>The SAM Pattern</h1>
            <p>SAM (State-Action-Model) is a software engineering pattern that helps manage and reason about the application state.
            SAM's founding principle is that State Mutation must be a first class citizen of the programming model.</p>
            
            <p>Let's consider the simplest application possible, an application that counts events</p> 
            <pre>var model = {counter: 0}</pre><br>
            Most software engineers would implement the application state mutation as an assignment:
<pre>model.counter = model.counter + 1 ;</pre>
            <br>
            SAM challenges that approach and suggests isolating application state mutations on the foundation of the Paxos protocol and TLA+:
<div class="code-window"><pre><code class="language-javascript">
// actions compute proposals
const proposal = {incrementBy: 1}

// the model accepts or rejects the proposals
model.accept(proposal)
    // the state function computes the new state representation
    .then(state)
</code></pre></div><br>

            <p>SAM is unapologetically driven by simplicity and does not require any library or framework.</p>
            <br>
            <p>This is what <a href="https://github.com/dagatsoin">Daniel Neveux</a>, Entrepreneur and Full Stack Developer, said:</p><br>
            <blockquote>SAM is simple, I have never seen a concept such minimalist and so powerful [in particular] in its decoupling potential</blockquote>
            <br>
            <table><tbody>
              <tr><td width="50%">Here is a 10 min introduction:</td><td width="50%">Here is an in depth presentation of the pattern in the context of Angular2</td></tr>  
              <tr><td><iframe width="420" height="315" src="https://www.youtube.com/embed/lMgSS_b98S8" frameborder="0" allowfullscreen></iframe></td><td><iframe width="420" height="315" src="https://www.youtube.com/embed/hJ8-YrZhECM" frameborder="0" allowfullscreen></iframe></td></tr>  
            </tbody></table>  
             
            <br>
            <br>
            You want to see some code? Take a look at the Fishing Game (index.html) <a href="https://glitch.com/edit/#!/plain-frog?path=views/index.html:1:0">here</a> which you can run <a href="https://plain-frog.glitch.me/">here</a>.
            <br>
            <br>
            <p>This new pattern was first introduced in an <a href="http://www.infoq.com/articles/no-more-mvc-frameworks">InfoQ article</a>, by <a href="http://www.ebpml.org/about">Jean-Jacques Dubray</a>. A translation of the article is available in <a href="http://www.infoq.com/cn/articles/no-more-mvc-frameworks">Chinese</a>, <a href="http://www.infoq.com/fr/articles/no-more-mvc-frameworks">French</a>, <a href="https://www.infoq.com/jp/articles/no-more-mvc-frameworks">Japanese</a> and <a href="https://habrahabr.ru/post/277113/">Russian</a></p>
            <br>
            <!-- a href="https://gitter.im/jdubray/sam"><button type="button" class="btn btn-sm btn-teal">Join the discussion on Gitter...</button></a -->
            You have some questions? &nbsp;&nbsp;<button class="btn btn-sm btn-teal js-gitter-toggle-chat-button">Join the discussion on Gitter...</button>
            <!-- button class="js-gitter-toggle-chat-button" data-gitter-toggle-chat-state="true">Open Community Forum</button>
            <button class="js-gitter-toggle-chat-button" data-gitter-toggle-chat-state="false">Close</button -->
            <br><br>If you like it, please consider sharing the word: &nbsp;&nbsp;<a class="twitter-share-button" href="http://twitter.com/share">Share on Twitter</a>
            <br>
            <ol class="toc">
              <li> 
                <a href="#sam">How does SAM work?</a>
                <ol>
                  <li><a href="#vf">The View as a function of the Model</a></li>
                  <li><a href="#bl">Business Logic</a></li>
                </ol>
              </li>
              <li><a href="#getstarted">How can I get started?</a></li>
              <li><a href="#info">Where can I can find more information?</a></li>
              <!-- li><a href="#using">Who is using SAM?</a></li -->
            </ol>
          </header>

          <section>
            <h2 id="sam">How does SAM work?</h2>
            <p>SAM is built on one of the most robust foundation of computer science (TLA+).<br>
            SAM recommends factoring application state management along three building blocks: actions, model and state 
            <ul><li>Actions are triggered by events, their role is to translate events into proposals to mutate the model</li>
            <li>The Model is solely responsible for the decision of accepting (or rejecting, or partially rejecting) these values</li>
            <li>Once accepted, the State function computes the State Representation from the Model property values and makes sure that everyone who needs to "learn" about the new application state is notified, such as the view which will display the “state representation”</li>
            <li>Finally, the State function computes the next-action-predicate which will invoke any automatic action, given the current application state</li></ul>
            Every event is processed as “step” which involves this reactive propose/accept/learn flow.<br>That's it! That's all there is to SAM.
            </p>  
            <p>The pattern is best implemented with the model as a single state tree and a unidirectional data flow. In the case of Front-End applications, SAM is best implemented when the view is a pure function of the State Representation. Two-way data binding is strictly prohibited as it would entail uncontrolled model mutations.</p>  
            <p>The pattern forms a reactive loop: events trigger actions which present data to the model, which computes the state representation. The reactive flow forms a natural step and after every step a new "state representation" is created (as a pure function of the model).</p>
            <p>As we show in many samples below, the view can be implemented as a series of stateless components which have no knowledge of the model or even the actions.</p>
            <p>When learning SAM, we recommend that you make a clear distinction between the programming model (State, Actions, Model), the wiring (how the elements of the pattern communicate) and the Architecture (where the elements of the pattern are physically running). SAM supports different wiring approaches and allows you to write code that can easily be migrated from the client to the server or vice versa (<a href="#iso">isomorphic javascript</a>). 
            <br><br>
            <figure>
              <a = href="assets/figures/fig6.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig6.jpg" alt="the SAM pattern"/></a>
              <figcaption>The State-Action-Model (SAM) Pattern</figcaption>
            </figure>
        
            <h3 id="vf">The View as a Function of the Model</h4>
            <p>When learning SAM in the context of Front-End applications, the best starting point is to understand the functional relationship between the view and the model. 
            SAM suggests decomposing the view as a series of pure functions that are fed with the properties of the State Representation. </p>
            <p>This concept is extremely simple to implement. I generally implement the front-end components as part of "theme" singleton (because themes are interchangeable):</p>
<div class="code-window"><pre><code class="language-javascript">
let theme = {} ;

// React
theme.ready = (counter,intents) => &lt;Counter count={counter} action={intents['start']}/&gt;
                            
let Counter = ({ counter,action }) =&gt;  (
    &lt;p&gt;Counter: {counter} &lt;/p&gt;
    &lt;button onClick={action}&gt;
      Start! 
    &lt;/button&gt;
  )

// Angular2 (with Directive)
view.ready = function(model) {
    return (
            `&lt;p&gt;Counter:${model.counter}&lt;/p&gt;
            &lt;form onSubmit="return actions.start({});"&gt;
                [Directive]&lt;br&gt;
                &lt;input type="text" placeHolder="AutoGrow Directive" autoGrow/&gt;&lt;br&gt;
                [/Directive]&lt;br&gt;
                &lt;br&gt;    
                &lt;input type="submit" value="Start"&gt;
            &lt;/form&gt;`
        ) ;

}

// Snabbdom
theme.ready = (counter, intents) =&gt; h('div', [
                'Counter: ',
                counter,
                h('br'),
                h('button', {on:{click:function() { intents['start'](); }}}, 'Start')
            ]);  

// Vanilla.js - ES6 
theme.ready = (counter, intents) =&gt; `
            &lt;p&gt;Counter: ${counter} &lt;/p&gt; 
            &lt;form onSubmit="return ${intents['start']}({});"&gt; 
                &lt;input type="submit" value="Start"&gt;
            &lt;/form&gt;`


</code></pre></div>
            <p>With SAM, front-end developers can focus on building the view directly from the State Representation, unencumbered from the underpinning APIs. How the we got to the current State Representation is irrelevant. This is the paradigm shift that React introduced in Front-End architectures.
               SAM does not always eliminate the need for interactions (request/responses), but it tends to keep a good balance between reactive and interactive modes.</p>
               <p>We get a fair amount of questions asking "why not use templates"? The reason is simple: templates are interpreters while functions are mini-code generators. Interpreters are limited in what they enable you to express (not to mention you often have to learn a specific syntax that does not translate at all to another template interpreter). 
               On the other hand, code generators are infinitely flexible with hardly any drawback. I would personally choose functions over templates any day.</p> 
               <p>SAM allows you to choose the framework of your choice <a href="https://medium.com/@metapgmr/hex-a-no-framework-approach-to-building-modern-web-apps-e43f74190b9c">including none</a>, but when using a Vanilla.js implementation, you need to make sure you mitigate <a href="https://www.google.com/about/appsecurity/learning/xss/">the risks of cross-site-scripting</a>.</p>
            <p>A couple of promising libraries have appeared recently (<a href="https://viperhtml.js.org/hyper.html">hyperHTML</a>, <a href="https://github.com/PolymerLabs/lit-html">lit-html</a> and <a href="http://yallajs.io/">yalla.js</a>) that offer support a "Functional HTML" approach. They, of course, are particularly good fit for the SAM Pattern.</p>
            <h3 id="bl">Business Logic</h4>
            <p>Not only SAM supports a functional structure for the View, but SAM enables a complete decoupling of the application logic from the View components. If you are not convinced you can look at this vanilla.js <a href="https://github.com/jdubray/sam-samples/blob/master/todomvc-app/js/app.js">TODO sample</a> and the "theme" section.</p>
            <p>
            SAM's factoring of the business logic is inspired from <a href="http://research.microsoft.com/en-us/um/people/lamport/tla/tla.html">TLA+</a>:
            <blockquote>TLA+ is based on the idea that the best way to describe things formally is with simple mathematics, and that a specification language should contain as little as possible beyond what is needed to write simple mathematics precisely. TLA+ is especially well suited for writing high-level specifications of concurrent and distributed systems. - Dr. Leslie Lamport</blockquote>
            If you are interested in learning about TLA+, I found <a href="http://www.loria.fr/~merz/talks/argentina2005/slides.pdf">Stephan Merz's course</a> the most approachable introduction to TLA+.
            </p>
            <p>TLA+ is a formal specification which can be used describe, analyze and reason about systems, such as:</p>
            <ul>
                <li>sequential algorithms</li>
                <li>interactive systems</li>
                <li>reactive & distributed systems</li>
                <li>real-time & hybrid systems</li>
                <li>security-sensitive systems</li>
            </ul>
            <p>TLA+ offers a uniform language where Mathematics form the basis for description and analysis of reactive and distributed systems. The key paradigm shift is that no programming language today support any "temporal" constructs. Making programming much more difficult and error prone than it ought to be.</p>
            <p>TLA defines two levels of syntax: action formulas and temporal formulas.</p>
               <ul><li>action formulas describe states and state transitions</li>
               <li>temporal formulas describe state sequences</li></ul>
            <p>TLA+ also includes concepts such as safety (something bad should never happen) and liveness (something good eventually happens).</p>
            <p>In SAM, the business logic is decomposed in three elements: Actions, the Model and the State.</p>
            <br>
            <p><span class="label label-warning">Warning</span> I have been told by readers that it is important to emphasize that SAM does not use the word "State" in the traditional sense of computer science (where a state is an assignment of values to all possible variables). 
              SAM suggests that the Model structure (and property values) are different from the State Representation, which there could be many of (Web, Mobile, Voice...). 
              The State Representation also includes the <a href="https://books.google.com/books?id=6lHCBAAAQBAJ&pg=PA67&lpg=PA67&dq=%22control+state%22+software&source=bl&ots=wX1DjBnziG&sig=LM91m-Tl_7g2K34DmK3B_aenGJY&hl=en&sa=X&ved=2ahUKEwjQhLjSuZ3fAhUIs1QKHWBZDh0Q6AEwB3oECAQQAQ#v=onepage&q=%22control%20state%22%20software&f=false">Control State</a> of the system. 
              The State-Action elements, in SAM, specify the behavior of the system (not the Model):</p> 
            <blockquote>A State-Action behavior is a sequence:<br>
<pre>
           α1    α2
        s1 −→ s2 −→ s3 −→  ...
</pre>
            <p>
                        The step &lt;s<sub>i</sub>, α<sub>i</sub>, s<sub>i+1</sub>&gt; represents a transition from
                        state s<sub>i</sub> to state s<sub>i+1</sub> that is performed by action α<sub>i</sub></p>
                        </blockquote>
            <br>
            <p>Please refer to Section 2 of <a href="http://research.microsoft.com/en-us/um/people/lamport/pubs/state-machine.pdf">this paper</a> from Dr. Lamport for a discussion on State-Action behavior.</p>
            <br>
            <p>If you don't like the State-Action-Model terminology, I could have also used the <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos protocol</a> terminology (PAL, Proposer, Acceptor and Learner):</p>
<pre>
Client   Proposer      Acceptor     Learner
|         |          |  |  |       |  |
X-------->|          |  |  |       |  |  Request
|         X--------->|->|->|       |  |  Prepare(1)
|         |<---------X--X--X       |  |  Promise(1,{Va,Vb,Vc})
|         X--------->|->|->|       |  |  Accept!(1,Vn)
|         |<---------X--X--X------>|->|  Accepted(1,Vn)
|<---------------------------------X--X  Response
|         |          |  |  |       |  |  
View     Action       Model         State  (SAM)
</pre>
            <br>            
            <p>In essence the Paxos protocol roles are exactly the roles of the SAM components: Actions propose values to the Model, which accepts them, which the State accesses (the Learner) to create the State Representation (which is displayed by the View).</p>
            <p>I personally like SAM because it surfaces the concept of "State-Action" behavior, which is at the core of SAM, and leads naturally to creating the "State Representation" (i.e. the View).</p>
            <p>So, for all intent and purposes, please be warned that SAM's Model is the assignment of values to all possible variables of the application state, while SAM's State (representation), which is sometimes contains the "control state" (such as "started" and "stopped" are two control states of a car), refers to a function that computes the current state representation and control state of the system. In general, the "State" of a system controls which actions are allowed at any given point in time. 
              The decoupling State/Model supports a multiplicity of state functions (such as a car with a beginner or experienced modes).</p>
            <br>
            <br>
            <!--
            <p>Here is <a href="https://github.com/jdubray/sam-samples/tree/master/crud-blog">a sample CRUD application</a> built with SAM. You can add, delete or update records (The sample is <a href="https://fish-trader.hyperdev.space/">hosted on hyperdev</a>)
            </p>
            <div class="code-window"><iframe src="https://fish-trader.hyperdev.space/" width="100%" height="1190" style="border:none"></iframe></div>
            <br>
            <br>
            -->
            <h4 id="actions">Actions</h4>
            <p>
                Actions are functions which translate an event into a proposal which contains the values 
                we want the model to accept. There is nothing else to it.
                <a href="http://redux.js.org/docs/basics/Actions.html">In Redux for instance</a>, "actions" are a data structure, which are a lot closer to an intent or event than an action. This is a fundamental difference between Redux and SAM 
                because in Redux the reducer creates an unnecessary and unwanted coupling between the model mutations and the logic that translates intents into model property values.
<div class="code-window"><pre><code class="language-javascript">
    
    // Reactive loop wiring
    function action(event, present) {
        // compute the values we want the model to mutate to
        const proposal = the_actual_pure_function_implementing_the_action(event) ;
        
        // present these values to the model
        present(proposal) ;
        
        // since we are in a reactive loop, the action returns nothing
    }
    
</code></pre></div>
                Actions typically implement context specific logic. If we take the example of a "change of address" action, we might  
                implement some context specific rules, such as when there is no country specified in the input dataset, the default country 
                is Australia, while the model is responsible for the integrity of a customer address which requires a country value. 
                Actions play another important role with respect to invoking 3rd party APIs. For instance, we can define an action which 
                will invoke a 3rd party validation service, which given an address, returns the postal address (or an error). It is then 
                the postal address which is presented to the model. 
<div class="code-window"><pre><code class="language-javascript">
    
    async function changeOfAddress(address = {}, present) {
        address.country = address.country || 'Australia' ; 
        const postalAddress = await getPostalAddress(address); 
        // assuming the dataset returned by the 3rd party
        // service can be directly presented to the model
        present(postalAddress) ;
    }) ;
        
    }
    
</code></pre></div>
            </p>
            <p>Actions are typically highly reusable across models, and we could even imagine some companies starting offering SAM actions following a SaaS model. A "change of address" action, which returns a postal address given user data is highly reusable, across many businesses. 
            </p>
            <br>
            <h4 id="model">Model</h4>
            <p>
            The model is a singleton that contains all the application state and (logically) exposes a single method: present(proposal). The model is responsible for accepting (or rejecting) the effects of an action. 
            The model is where integrity rules get enforced. In other words, actions are generally triggered with some context specific data, they 
            do not have access to the application state, for instance, when you implement a "change password" action, the action will check
            if the password is valid in the context of the request, but the model might enforce additional integrity rules, such that you 
            cannot use a password that matches any of your last three passwords.
            </p>
            <p>The model is also solely responsible for the persistence of the application state. As such, the Model's architecture may follow the <a href="https://github.com/eventstore/eventstore/wiki/Event-Sourcing-Basics#event-sourcing">Event/Command Sourcing Pattern</a> with respect to the data the it accepts:</p>
            
<div class="code-window"><pre><code class="language-javascript">
    
    model.present = function(proposal, state) {
        
        if (proposal.address !== undefined) {
            model.shippingAddress = proposal.address ;
            model.billingAddress = model.billingAddress || proposal.address ;
        }
        
        // trigger the state representation computation
        state(model) ;
        
        // since we are in a reactive loop, the present method returns nothing
    }
    
</code></pre></div>
            
            <br>
            <h4 id="state">State</h4>
            <p>
            This concept is unique to SAM. Its purpose is to futher decouple the Model from the View. The State function has two roles: 
            <ul><li>Translate the model property values into a State Representation</li>
            <li>Compute the control state and trigger the next-action predicate</li>
            </ul>
            <br>
            Unintuitively, the State is a pure function that does not hold any (application) “state”.
            The State function also computes the current "control state" of the system, but <b>SAM does not require the State implementation to be based the semantics of finite state machines</b>. It offers a structure that is compatible with FSMs but for the most part avoids the unecessaries intricaties of FSMs.
            In the Rocket Launcher example, to demonstrate the compatibility, we've have implemented the full semantics of a finite state machine where each control state is computed with pure functions such as:
<div class="code-window"><pre><code class="language-javascript">
// Assuming the following model structure
var model = {
        counter: COUNTER_MAX, 
        started: false,      
        launched: false, 
        aborted: false}
    
    
// Derive the current control states of the system
const ready = model => (model.counter === COUNTER_MAX) && !model.started && !model.launched && !model.aborted

const counting =model => (model.counter <= COUNTER_MAX) && (model.counter >= 0) && model.started && !model.launched && !model.aborted)

const state = (model, render) => {
    const stateRepresentation = _state(model)
    if (!nextActionPredicate(stateRepresentation)) {
      render(stateRepresentation, model.present) 
    }
}

const _state = model => {
    // Compute the control state
    const stateRepresentation = model
    let controlState = 'oops... something went wrong, the system is in an invalid state' ;
    
    if (ready(model)) {
      controlState = 'ready' ;
    } 

    if (counting(model)) {
      controlState = 'counting' ;
    }

    if (launched(model)) {
      controlState = 'launched' ;
    }

    if (aborted(model)) {
      controlState = 'aborted' ;
    }
    
    // Other computations that are part of the state representation go here

    return { controlState, ...stateRepresentation }
}
    
</code></pre></div>            
            </p>
            <p>Depending on the number of control states of your application and the size of your model, these functions can become rather tedious to write. Again, there is no requirement to adopt such an approach, it may help in some cases and be a burden in others where a series of if-then-else on some key properties of the model would be good enough.</p>
            <p>Once the state representation is rendered, the State function is responsible for invoking the next-action predicate (nap), which is a function of the model. The purpose of the nap() function is to determine if, given the current control state of the model, there are some automatic actions that need to be invoked. For instance in the <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample">Rocket Launcher</a> example, 
            the "decrement()" action is invoked by the next-action predicate while the system is in the counting state. When the counter reaches zero, it invokes the "launch()" action.
            </p>

<div class="code-window"><pre><code class="language-javascript">
const nextAction = (stateRepresentation, present) => {
    if (stateRepresentation.controlState === 'counting') {
        if (stateRepresentation.counter>0) {
            actions.decrement({ counter: stateRepresentation.counter }, present)
            return true
        }

        if (stateRepresentation.counter === 0) {
            actions.launch({}, present) 
            return true
        }
    }

    return false
}
</code></pre></div>   

            <br>
            <p>When you feel that a full state machine is required for your app, you may use a library such as the <a href="https://bitbucket.org/jdubray/star-javascript">STAR library</a>.</p>
            <br>
            <h4 id="sr">Rendering (or Consumming) the State Representation</h4>
            <p>
            In Front-End applications, the State Representation is typically rendered as part of the reactive loop, however, in the most general sense, the state representation is published to consumers (i.e. Learners in Paxos). Formulating the View as a series of pure functions of the state representation work well.  
           </p>
            <p>
            One of the key problems that front-end frameworks try to tackle is the wiring between the HTML events and event handlers. 
            View components can be decoupled from actions via a list of "intents" which map the application's action to the view component's handlers. We have implemented that approch in <a href="https://github.com/jdubray/sam-samples/blob/master/todomvc-app/js/app.js">the TODOSAM sample</a>. All the theme's components accept an intent map:
<div class="code-window"><pre><code class="language-javascript">
theme.list = (todos, displayActive, displayCompleted, intents) => {

    ... 

    const label = `&lt;label ondblclick="return actions.${intents['edit']}({'id':'${todo.id}'});"&gt;${todo.name}&lt;/label&gt;` ;

    ... 

}

// mapping view intents -> actions
actions.intents = {
  edit: 'edit',
  save: 'save',
  done: 'done',
  displayAll: 'displayAll',
  displayActive: 'displayActive',
  displayCompleted: 'displayCompleted',
  toggleAll: 'toggleAll',
  delete: 'delete'

}
</code></pre></div> 
            <br>
            The concept could also be extended to map the event format to be directly consumable by the action, but this coupling is less important than the coupling of the actions with the view. 
            </p>
            <br>
            <h4 id="wiring">Wiring</h4>
            <p>
            The SAM pattern can be described as a Mathematical expression (formula):
            <pre>V = State( Model.present( Action( event ) ) ).then( nap )</pre>
            However, that expression is only a logical expression that describes the sequence in which the elements of the pattern are invoked. The expression itself is not representative of the Reactive Flow or the different wiring options. 
            </p>
            <p>SAM can be implemented in the browser (<a href="http://andrewhfarmer.com/react-ajax-best-practices">like React and Redux</a>), but one of SAM's advantages is that the elements of the pattern can be distributed and composed in virtually any topology. 
            So there is not a single way to wire the pattern.</p>
            <p>You should also keep in mind that SAM is a reactive pattern so there is never a response that is expected: The view triggers an action, which presents its proposal to the model, which asks the state to create a state representation, which is rendered by the view and displayed in the browser. 
              SAM could also be used with an interactive wiring where a request is wired to an action and the state representation becomes the response to the request.</p>
            <p>Let's start with a sample where running SAM exclusively in a single process (e.g. the browser, perhaps assuming the model will communicate with a persistent store).</p>
            <p>The model can be defined as a singleton, the actions as pure functions of an event payload, the state (stateRepresentation() and nap()) as a pure function of the model:</p>
<div class="code-window"><pre><code class="language-javascript">

// Model is a singleton /////////////////////////////////////////////
const model = {} ;

model.present = function(data) {
    // Logic that accepts or rejects the proposed values
    // ...
    
    // -> Reactive Loop
    state(model) 
    
    // persist the new state
    // this is generally guarded and optimized
    model.persist() 
} 

model.persist = function() {
    // some persistence code
    ...
} 

// Actions are pure functions /////////////////////////////////////////////  
function action1(data) {
    // Logic that prepares the data to be presented to the model
    // ...
    
    // -> Reactive Loop
    present(data) 
    
    // to avoid a page reload
    return false 
} 

function action2(data) {
    // Logic that prepares the data to be presented to the model
    // ...
    
    // -> Reactive Loop
    present(data) ;
    
    // to avoid a page reload
    return false ;
} 

// State is a pure function /////////////////////////////////////////////
function state(model) {

    // Compute State Representation
    const sr = stateRepresentation(model) 
    // Invoke next-action-predicate
    if (!nap(sr)) {
      // Render the view when no next action is invoked
      view.render(sr)
    }
} 

function nap(stateRepresentation) {

    if (condition(stateRepresentation)) {
        const event = e(stateRepresentation) 
        action2(event) 
        return true
    }

    return false
}


// View is a pure function of the state representation /////////////////////////////////////////////
const view = {
    render({a, b, c}) {

        // render the view
        let output = '<p>${a} and ${b}</p>' 
        // ...
        
        // wire the possible actions in the view
        output = output + `<button onclick="JavaScript:return action1({data:data});">${c}</button>`
        
        // ...
        // -> Complete Reactive Loop 
        display(output) 
    }
}



// Wiring /////////////////////////////////////////////
// 
// Actions are known to the stateRepresentation() and nap()
//
// Actions -> Model
function present(proposal) {

    model.present(proposal) ;

} 


// View -> Display
function display(nextState) {

    let view = document.getElementById("view")
    view.innerHTML = nextState

}


</code></pre></div>   
            <br><br>
            <p>Of course, JQuery event handlers could also be used:</p>
<div class="code-window"><pre><code class="language-markup">

...

&lt;input id="username" type="text" class="login-username" value="username"&gt;
&lt;input id="password" type="password" class="login-password" value="password"&gt;
&lt;button class="button button-green center-button" id="login"&gt;Login&lt;/button&gt;

...

&lt;script type="text/javascript"&gt;
$('#login').click(function() {
    var session = $.post( "http://authserver/v1/login", { username: $( "#username" ).val(), password:$( "#password" ).val() } ) ;
        session.done(function( data ) {
            var loginPanel = document.getElementById("login_panel") ;
            loginPanel.innerHTML = state.render(model.present(data)) ;
             ;
        })
}) ;
&lt;/script&gt;

... 

// another option is to implement the state, model and actions on the server:

&lt;script type="text/javascript"&gt;
$('#login').click(function() {
    var session = $.post( "http://authserver/v1/login", { username: $( "#username" ).val(), password:$( "#password" ).val() } ) ;
        session.done(function( stateRepresentation ) {
            var loginPanel = document.getElementById("login_panel") ;
            loginPanel.innerHTML = stateRepresentation ;
             ;
        })
}) ;
&lt;/script&gt;

</code></pre></div>   

<br>
<br>
            <p>One can also use <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/events.md">RxJS</a> to wire events to actions.</p>
<div class="code-window"><pre><code class="language-javascript">

var result = document.getElementById('submit');

var source = Rx.Observable.fromEvent(document, 'click');

var subscription = source.subscribe(function (e) {
  var data = { name: document.getElementById('name').value, ... } 
  result.innerHTML = state.render(model.present(data));
});
</code></pre></div>   

<br>
            <p>Wiring is an important concern when implementing the pattern. For instance, the <a href="https://medium.com/@mweststrate/pure-rendering-in-the-light-of-time-and-state-4b537d8d40b1#.q91pjr4c7">mobx framework</a> wires individual property value changes to the view rendering function, which is not representative of the behavior of the system and the processing of an action as a unit of work.
            As you can see in the example tab below, the view renders for state data changes:</p>
<br>
<div class="code-window">
    
    <pre><code class="language-javascript">
// The state of our app
var state = mobx.observable({
    nrOfSeats : 500,
    reservations : [],
    seatsLeft : function() { return this.nrOfSeats - this.reservations.length; }
});

// The UI; a function that is applied to the state
var ui = mobx.computed(function() {
    return "\n<div>Seats left: " + state.seatsLeft + 
        "<hr/>Attendees: " + state.reservations.join(", ") + "</div>";
});

// Make sure the UI is 'rendered' whenever it changes
ui.observe(function(newView) { console.log(newView) }, true);

// Put in some test data
state.reservations[0] = "Michel";
state.reservations.push("You?");
state.reservations[0] = "@mweststrate";
state.nrOfSeats = 750;
</code></pre>
<div class="code-preview"> 
&lt;div&gt;Seats left: 500&lt;hr/&gt;Attendees: &lt;/div&gt;<br>
&lt;div&gt;Seats left: 499&lt;hr/&gt;Attendees: Michel&lt;/div&gt;<br>
&lt;div&gt;Seats left: 498&lt;hr/&gt;Attendees: Michel, You?&lt;/div&gt;<br>
&lt;div&gt;Seats left: 498&lt;hr/&gt;Attendees: @mweststrate, You?&lt;/div&gt;<br>
&lt;div&gt;Seats left: 748&lt;hr/&gt;Attendees: @mweststrate, You?&lt;/div&gt;<br>
</div>
</div>
            <br>
            <br>
            <h4 id="timetravel">Time Travel</h4>
            <p>
                Gunar Gessner has implemented <a href="https://github.com/sam-js/sam-devtools">a client-side "Time Travel" dev tool</a> that enables you to take snapshots of the model after 
                every action is processed and then restore the state of the system with a given snapshot. 
            </p>
            <p>
                The SAFE container implements <a href="https://github.com/jdubray/sam-safe/blob/master/README.md#time-travel">both a client-side and server-side "Time Travel" dev tool</a>.<br><br> 
                <iframe width="420" height="315" src="https://www.youtube.com/embed/o7ZIG4jT0xM" frameborder="0" allowfullscreen></iframe>
            </p>
            <br>
            <br>
            <h4 id="container">Micro Container</h4>
            <p>
            The <a href="https://github.com/jdubray/sam-safe">SAFE project</a> (State-Action-Fabric-Element) is a micro-container for SAM implementations which can run in the browser or on node.js. 
            At a minimum SAFE enables you to wire the elements of the pattern. It also comes with Session Management, Logging and Error Handling. The 
            current version enables global validation and enforcement of actions, including action "hang back". Last but not least, it implements the Time Travel dev tool.
            </p>
            <br>
            <br>
            <h4 id="comp">Composition</h4>
            <p>
            The SAM pattern offers some generous composition mechanisms.    
            </p>
            <p>First Actions, as pure functions, compose naturally to present a single dataset to the model:</p>
            <pre>C(data) = A(B(data))</pre>
            <p>This type of composition is a functional composition and the resulting action is considered to be a single action applied to the system from SAM's point of view. Logically you cannot compose Actions, as it would violate, the Action->Model->State step, you can only create "composite" actions.</p>
            <p>Similarly, the State Representation (View) can be decomposed in a hierarchy of components:</p>
<pre>
V = f( M )
f( M ) = f1( g1(M) + g2(M) ) + f2( h1(M) + h2(M) )
</pre>
            <br>
            <p>The most interesting composition mechanisms are at the pattern level itself. For instance, SAM supports an instance level composition where one instances runs in the browser and one instance runs in the server.</p>
            <a = href="assets/figures/fig9.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig9.jpg" alt=""/></a>
            <br>
<pre>
// The composition has a single view
V = Ss( Ms ) + Sc( Mc )

// Instance c (browser) invokes an action on instance s (server)
// this action is generally invoked in the nap() function of the client
V = Ss( Ms.present( As(Mc) )
</pre>            
<br>
<p>Though it is theoretically possible, it is highly recommended to refrain from invoking client actions from the server.
The role of the server is rather to deliver the SAM client instance as part of its state representation.
</p>
<p>Here is <a href="https://github.com/jdubray/sam-samples/tree/master/react-child-instance">a Parent/Child</a> sample using React 15.0.2 with JSX/Babel. It shows how you can implement a complex form of wizard with a child instance and submit the resulting dataset to the parent, once the content of the form is valid.</p>

<p>NOTE: THIS IS JUST SOME INITIAL THOUGHTS, NEED MORE WORK:<br>SAM also offers an interesting alternative composition mechanism which enable to synchronize a client side and server side model, by which you present the same dataset to both the client side and server side model.</p>
<figure><a = href="assets/figures/fig11.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig11.jpg" alt="" width="370"/></a></figure>
            <br>
            <h4 id="sm">State Machines and Automatic Actions</h4>
            <blockquote>Computation is a major topic of computer science,<br>
                        and almost every object that computes is naturally viewed as a state machine.<br>
                        Yet computer scientists are so focused on the languages used to<br>
                        describe computation that they are largely unaware that those languages<br>
                        are all describing state machines - <a href="http://research.microsoft.com/en-us/um/people/lamport/pubs/state-machine.pdf">Dr. Leslie Lamport</a></blockquote>
            <p>
            SAM is particularly well aligned with the semantics of State Machines except for one simple, yet fundamental difference. 
            Classical State Machine semantics (based on Petri Nets) imply that the actions somehow connect two states, so State Machines are described as a series of tuples such as:
<pre>initialState = S<sub>0</sub>
(S<sub>0</sub>,A<sub>01</sub>,S<sub>1</sub>), (S<sub>1</sub>,A<sub>12</sub>,S<sub>2</sub>)...
</pre>
<br>
            This definition is <a href="https://dzone.com/articles/the-three-approximations-you-should-never-use-when">somewhat of an approximation</a>: it is not the action that decides the resulting state, it is the model, which, once the action has been applied (its value have been accepted, or not) that decides the resulting state (A<sub>ik</sub> are the allowed actions in a given state S<sub>i</sub>) : 
<pre>initialState = S<sub>0</sub> = S( M0 ) 
(S<sub>0</sub>, A<sub>00</sub>, A<sub>01</sub>), (S<sub>1</sub>, A<sub>10</sub>, A<sub>11</sub>, A<sub>12</sub>)...
S<sub>0</sub> = S( M0 )
S<sub>1</sub> = S( M1 )
...
</pre><br>
            The tuples (S<sub>i</sub>,A<sub>ik</sub>,S<sub>k</sub>) are merely an observation of the behavior of the state machine, rather than a physical representation of its runtime.<br> 
            This change of perspective (not semantics) is minute, yet fundamental. SAM would not work (as well) if the traditional semantics of State Machine would be structuring the code. 
            The SAM semantics are inclusive of this traditional structure, and therefore strictly compatible, but SAM by no means require that one uses a graph of State and Actions.
            </p>
            <p>I believe that is why some people have expressed that SAM "feels natural".</p>
            <p>The <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample">Rocket Launcher</a> example shows how to implement the Sx() functions:</p>

<div class="code-window"><pre><code class="language-javascript">
// Derive the current state of the system
state.ready = function(model) {
    return ((model.counter === COUNTER_MAX) && !model.started && !model.launched && !model.aborted) ;
}

state.counting = function(model) {
    var status = ((model.counter <= COUNTER_MAX) && (model.counter >= 0) && model.started && !model.launched && !model.aborted) ;
    return status ;
}

state.launched = function(model) {
    return ((model.counter == 0) && model.started && model.launched && !model.aborted) ;
}

state.aborted = function(model) {
    return (
        (  model.counter <= COUNTER_MAX) && (model.counter >= 0) 
        && model.started && !model.launched && model.aborted ) ;
}
</code></pre></div>   
            <br>
            <p>I cannot emphasize enough that it is not necessary to adopt a State Machine structure to use SAM and more often than not if-then-else will be adequate. However, sometimes it may become easier to use a strict State Machine structure.
            These functions can be used to validate that an action is enabled or not. They can also more naturally break down the hierarchy in from which the view is rendered.</p>
            
            <br>
            <h4 id="apis">APIs</h4>
            <p>
            SAM was originally designed to solve the strong coupling that MVC creates between the Front-End structure and the Back-End APIs. APIs can be composed at a couple levels in SAM:
            <ul>
                <li>Actions: for APIs with no side-effect whatsoever on the model</li>
                <li>Model: for CRUD APIs that persist/populate the model property values (commonly called the Data Access Layer)</li>
            </ul>
            Concurrency issues aside, an action can present its values when after processing an API call, for instance: 
            </p>
<div class="code-window"><pre><code class="language-javascript">
function getRssFeed(data) {
    
    var options = {
      url: 'http://www.ebpml.org/blog15/feed/',
      headers: {
        'accept': 'application/json'
      }
    };
    
    request(options, function (error, response, body) {
       if (!error && response.statusCode == 200) {
            
            // parse the RSS feed into a json object
            parseString(body, function (err, result) {
            
                // prepare proposed dataset
                data.blog = result.rss.channel[0].item ;
               
                // present data to the model
                present(data) ;
           });
       }
     });
}
</code></pre></div>   
            <br>
            <p>Similarly, the model can perform all the persistence operations (which could result in rejecting some proposed values) before passing control of the Reactive Loop to the State object.
            That is very different from React because you cannot touch the State without triggering a rendering of the view, which makes very little sense, when you think of it. It only makes sense when you spread the model state into 
            the various components, and even then it warps the articulation of APIs with the Front-End reactive Flow.
            </p>
            <br>
            <br>
            <h4 id="headless">Headless SAM</h4>
            <p>
            SAM can also be used without a View, whereby it listens on incoming Action requests and returns a response which can be the model of a fraction of the model. As such SAM offers a new API implementation pattern which is particularly well suited for implementating Stateful APIs. 
            </p>
            <br>
            <figure>
              <a = href="assets/figures/fig12.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig12.jpg" alt=""/></a>
            </figure>
            <br><br>
            <p>A node.js implementation of Headless SAM would look like this:</p>
<div class="code-window"><pre><code class="language-javascript">

var express = require('express');
var app = express();

//// Model ////////////////////////////

var S0 = { ... } ;

var present = (

    function (initialState) {
        var model = initialState ;
        return (function( data, res) {
        
            // mutate the model
            ...
        
            state(model) ;
        }) ;
    }
    
)(S0);


//// Actions ////////////////////////////

actions.addAPI('submit') ;
app.post(actions.apis.submit.path, function(req,res) {
    
    // extract intent from request body
    var intent = new Intent('submit',req.body) ;
    
    // Compute model property values
    data_ = actions.impl.submit(intent) ;
    
    // present data to the model
    presentToModel(data_, res) ; 
    
}) ;

//// State ////////////////////////////

function state(model) {
    
    // prepare and return API response
    var response = model.response() ;
    res.send(response) ;
    
    // execute next action predicate
    nap(model) ;

}

</code></pre></div> 
            <br>
            The pattern can easily be adapted to mount a user session in the model or rehydrate/dehydrate the context of the request before/after the model mutates.
            <br>
            <br>
            <h4 id="iso">Isomorphic JavaScript</h4>
            <p>
            Typical SAM's implementations make it easy to move JavaScript code between the client or the server (a.k.a <a href="http://isomorphic.net/">Isomorphic JavaScript</a>). 
            <br><br>
            <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Client</th>
                    <th>Server</th>
                    <th>Implementation</th>
                  </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td width="20%">View</td>
                        <td width="20%">Actions, Model, State</td>
                        <td width="60%">Event handlers call Actions<br>Server returns HTML</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>View,Actions</td>
                        <td>Model, State</td>
                        <td>Event handlers implement actions which call present()<br>Server returns HTML</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>View,Model,State</td>
                        <td>Actions</td>
                        <td>Event handlers invoke Actions, response is presented to the Model on the client<br>Server returns JSON</td>
                    </tr>
                    <tr>
                        <th scope="row">4</th>
                        <td>View,State</td>
                        <td>Actions,Model</td>
                        <td>Event handlers invoke Actions, response is presented to the State on the client<br>Server returns JSON</td>
                    </tr>
                    <tr>
                        <th scope="row">5</th>
                        <td>View,Actions,State</td>
                        <td>Model</td>
                        <td>Event handlers implement Actions which call present(), response is presented to the State on the client<br>Server returns JSON</td>
                    </tr>
                </tbody>
            </table>
            <br>
            <p>For instance, in the <a href="https://github.com/jdubray/sam-samples/tree/master/crud-blog">Blog sample</a> we have implemented the Actions on the client and the Model and the State on the server. 
            In that case, we have to implement two "APIs" on the server:<br>
            <ul><li>init()</li><li>present(data)</li></ul></p>
            <br>
            Option #1 should be preferred when authorization (RBAC) is a concern. Option #5 is the one that pushes as much processing on the client as possible.  
            </p>
<div class="code-window"><pre><code class="language-javascript">
    
function present(data) {
    // client side
    //model.present(data) ;

    // server side
    $.post( "http://localhost:5425/app/v1/present", data) 
    .done(function( representation ) {
        $( "#representation" ).html( representation );
    }       
    );
}

function init() {
    // client side
    //view.display(view.init(model)) ;

    // server side
    $.get( "http://locahost:5425/app/v1/init", function( data ) {
        $( "#representation" ).html( data );
    }       
    );
}            

</code></pre></div>             
            <br>
            <br>
            <h4 id="conc">Concurrency</h4>
            <p>
            JavaScript is a <a href="https://www.youtube.com/watch?v=Qg1SvpIau6U">concurrent programming language</a>. In SAM, the model is a critical section that must be synchronized. In simple applications, this is usually achieved without any specific considerations. 
            SAM's structure where actions can invoke APIs prior to presenting their proposal to model helps significantly by isolating the way the proposal is constructed from the application state mutation. In particular, another action executed concurrently would be able to present it's proposal as if the first (long running) action would have never been triggered.    
            </p>
            <p>
            When concurrency is an issue, it's possible to use the "<a href="https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm">Bakery Algorithm</a>", again using the work of Dr. Lamport. 
            </p>
          </section>

          <section>
          <h2 id="getstarted">How can I get started?</h2>
          <p>First, I would recommend getting familiar with the approach I call "functional HTML" perhaps starting with <a href="https://medium.com/@metapgmr/hex-a-no-framework-approach-to-building-modern-web-apps-e43f74190b9c">this article</a> and <a href="https://codepen.io/sam-pattern/pen/qPXaqB">its samples</a> (which are not SAM based).</p>
          <p>Then I would build a simple SAM loop [with plain vanilla Javascript](https://github.com/jdubray/sam-samples/blob/master/todomvc-app/js/app.js) and finally explore <a href="https://github.com/jdubray/startbootstrap-clean-blog">the boilerplate SAM sample, though these days I would recommend starting with the [lit-html version](https://github.com/jdubray/startbootstrap-clean-blog-lit-html)</a></p>
          <p>If you are up to building something more substantial, you could download an HTML5 template of your choice and start building an application with it. To make this tutorial more realistic, we are going to build a simple Web Site with Blog and a Contact form.</p>
          <p>The <a href="http://startbootstrap.com/template-overviews/sb-admin/">SB Admin template</a> seems like a great starting point. The list of components are easy to identify, from the index.html file:</p>
          <ul>
              <li>----- Structure ------</li>
              <li>Navigation Bar</li>
              <li>DropDown</li>
              <li>Search</li>
              <li>Menu</li>
              <li>Footer</li>
              <li>----- Structure ------</li>
              <li>Stats Summary</li>
              <li>Graphs</li>
              <li>Tables</li>
              <li>...</li>
          </ul>
          <br>
          <figure>
            <a = href="http://startbootstrap.com/template-overviews/sb-admin/"><img class="img-shadow img-responsive center-block" src="https://startbootstrap.com/assets/img/templates/sb-admin.jpg" alt=""/></a>
          </figure>
          <br>
          <p>Many developers dislike the code that will follow (let's call it vanilla.js).
          Since this is a matter of preferences, there is not much point in arguing about it. I just happen to prefer a raw JavaScript/HTML5/CSS3 style because: 
          <ul><li>it enables the greatest number of developers to become full stack developers (with Node.js)</li>
          <li>it enables the greatest decoupling between the View and the Model</li><li>Vanilla.js makes it really easy to develop <a href="https://strongloop.com/strongblog/node-js-react-isomorphic-javascript-why-it-matters/">Isomorphic JavaScript</a>
          </li>
          <li>And perhaps, most practically, it allows anyone to take the work of a Web designer and turn it into a beautiful Web app in a matter of minutes</li> 
          </ul>
          <br>The experienced developers will easily translate this code to meet their neesds. So let's go ahead and start creating the component interfaces without any further apologies:</p> 

<div class="code-window">
              <!-- div class="code-preview">

              </div-->

<pre class="line-numbers"><code class="language-javascript">var theme = {} ;

theme.head = function(title, includes, addons ) { } ;

theme.navBar = function(dropDowns,sideBar) { } ;

theme.adminDropDown = function(urls) { } ;

theme.search = function(search) { } ;

theme.menuItem = function(label,symbol, url, submenu, level) { } ;

theme.sideBar =  function(menu,color) { } ;

theme.well = function(size,h,title,body,br) { } ;

theme.footer = function( includes ) { } ;

theme.statSummary = function(fa,label,number,link,linkLabel,color) { } ;

theme.advancedTable = function(size,id,color,heading,headers,columns,data,href,domain) { } ;

theme.ediTable = function(id,headers,data,editable, style, maxSize) { } ;

... 

</code></pre>
            </div>
            <p>The implementation of each function is just a parameterization of the HTML template (the whole theme implementation <a href="https://github.com/jdubray/sam-samples/tree/master/sbadmin-template/theme">can be found here</a>):</p>
            <div class="code-window">
                          <!-- div class="code-preview">
            
                          </div-->
            
<pre class="line-numbers"><code class="language-javascript">
theme.statSummary = function(fa,label,number,link,linkLabel,color) {
        return (
          `&lt;div class="col-lg-3 col-md-6"&gt;
              &lt;div class="panel panel-${color}"&gt;
                  &lt;div class="panel-heading"&gt;
                      &lt;div class="row"&gt;
                          &lt;div class="col-xs-3"&gt;
                              &lt;i class="fa fa-${fa} fa-5x"&gt;&lt;/i&gt;
                          &lt;/div&gt;
                          &lt;div class="col-xs-9 text-right"&gt;
                              &lt;div class="huge">${number}&lt;/div&gt;
                              &lt;div&gt;${label}&lt;/div&gt;
                          &lt;/div&gt;
                      &lt;/div&gt;
                  &lt;/div&gt;
                  &lt;a href="${link}"&gt;
                  &lt;div class="panel-footer"&gt;
                      &lt;span class="pull-left">${linkLabel}&lt;/span&gt;&gt;
                      &lt;span class="pull-right"&gt;&lt;i class="fa fa-arrow-circle-right">&lt;/i&gt;&lt;/span&gt;
                      &lt;div class="clearfix"&gt;&lt;/div&gt;
                  &lt;/div&gt;
                  &lt;/a&gt;
              &lt;/div&gt;
          &lt;/div&gt;`) ;
} ;

</code></pre></div>
            
          </section>
          
          <section>
          <h2 id="samples">Code Samples</h2>
          <!-- script src="https://opencollective.com/sam/banner.js"></script -->

          <p>
                <h3 id="rocket">Rocket Launcher</h3>
                <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample" id="rocket">Vanilla JavaScript and HTML</a> - You can run that sample <a href="https://bb.githack.com/!api/2.0/snippets/jdubray/9dgKp/a1dd9b8b9f241600ad108ef741845241c31c9fce/files/rocket.html">here</a> (courtesy of <a href="https://twitter.com/jose_pedro_dias"> Jose Pedro Dias</a>)<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/mobx-react-typescript-boilerplate-master">MobX + React</a> (<a href="http://www.linkedin.com/in/fredericdaoud">Fred Daoud</a>)<br>
                <a href="http://codepen.io/foxdonut/pen/XXPwRe">Cycle.js</a> (<a href="http://www.linkedin.com/in/fredericdaoud">Fred Daoud</a>)<br>
                <a href="https://github.com/JosePedroDias/sam_rocket_w_snabbdom">Snabbdom</a> (<a href="https://twitter.com/jose_pedro_dias"> Jose Pedro Dias</a>). You can run the sample <a href="https://josepedrodias.github.io/sam_rocket_w_snabbdom/index.html">here</a>.<br>
                <a href="https://jsfiddle.net/80xzt848/1/">Knockout.js</a> (<a href="http://blog.troyingram.us/">Troy Ingram</a>)<br>
                <a href="https://github.com/gunar/sam-redux" id="rocketreact">React+Redux (following the SAM pattern)</a> (<a href="https://twitter.com/gunar">Gunar Gessner)</a><br>
                <a href="https://github.com/brusand/sam-angular" id="rocketng">Angular (following the SAM pattern)</a> (Bruno Darrigues)<br>
                <a href="https://github.com/brusand/sam-typescript " id="rocketng">Angular+TypeScript (following the SAM pattern)</a> (Bruno Darrigues)<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/inferno-rocket" id="inferno">Inferno</a><br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/angular2-rocket-2.0.0" id="angular2">Angular2 with Dynamic templates and ComponentFactory</a><br>
                <a href="http://codepen.io/foxdonut/pen/BzQzBx?editors=1010" id="redux">Vanilla.js+Redux</a> (<a href="http://www.linkedin.com/in/fredericdaoud">Fred Daoud</a>)<br>
                <br>
                <h3 id="rectangle">Fishing Game</h3>
                <a href="https://glitch.com/edit/#!/project/plain-frog" id="redux">Vanilla.js</a><br>
                <br>
                <h3 id="todo">ToDo</h3>
                <a href="https://bitbucket.org/snippets/jdubray/zr9r6/item-list" id="listsample">Vanilla JavaScript and HTML</a><br>
                <a href="http://codepen.io/msolovyov/pen/qbvYpv?editors=1010">Vue.js</a> (<a href="">Michael Solovyov</a>)<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/todomvc-app" id="todosample">TODOMVC Challange (HTML+Vanilla JS, both ES5 and ES6)</a>
                <a href="https://github.com/jdubray/sam-samples/tree/master/angular2-admin-master-2.0.0" id="ng2-todosample">Angular2 Admin Template with ToDo component with RxJS</a>
                <a href="https://github.com/Nivani/todo-sam">This is a TodoMVC project</a> that shows how SAM Pattern can be implemented in a typical Angular application with ngrx (@Nivani)
                <br>
                <h3 id="blog">Blog</h3>
                <a href="https://github.com/jdubray/sam-samples/tree/master/crud-blog">Node.js / Isomorphic JavaScript - BootStrap</a><br>
                
                <h3 id="contact">Contact</h3>
                <a href="https://bitbucket.org/snippets/jdubray/jna7B/sam-sample-app-on-nodejs" id="nodesample">Simple Web site with Contact App (Node.js+HTML)</a><br>
                <br>


                
                <h3 id="sbadmin">Themes</h3>
                <a href="https://github.com/jdubray/sam-samples/tree/master/sbadmin-template" id="sbadminsample">A simple Web app built on the SB Admin template (Node.js+HTML)</a><br>
                <a href="https://github.com/imnutz/sam-exmachina" id="exmachina">A simple Web Site</a> (with actions) built on the <a href="http://templated.co/exmachina">Ex-Machina template</a> (HTML+Snabbdom) (@imnutz / Son Ngoc)<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/vanilla-es6-boilerplate-project" id="vanilla-boilerplate">A Vanilla ES6 Builerplate Project</a><br>
                <a href="https://github.com/jdubray/startbootstrap-clean-blog" id="cleanblog">A full stack, vanilla.js/Node.js of the Bootstrap Clean Blog project</a> (ES6)
                <br>
                <h3 id="othersamples">Others</h3>
                A dual-client (session based) <a href="https://github.com/509dave16/sam-tic-tac-toe">Tic-Tac-Toe game</a> with a <a href="https://github.com/509dave16/tic-tac-toe-engine">SAM-based engine</a> (React/Redux+Firebase) via <a href="https://github.com/509dave16">David Fall</a>
                A simple Counter App using <a href="https://github.com/imnutz/sam-flyd">Flyd</a> (@imnutz / <a href="https://twitter.com/sonngoc">Son Ngoc</a>)<br>
                <a href="http://codepen.io/devghost/pen/eZWxmo">How to use Mocha and Chai</a> to write unit tests (BDD) for SAM implementations (via Robert Blixt)<br>
                A contact manager web application built with <a href="https://github.com/imnutz/sam-csp">SAM and CSP</a> (<a href="http://jlongster.com/Taming-the-Asynchronous-Beast-with-CSP-in-JavaScript">Communicating Sequential Processes</a>) (@imnutz / <a href="https://twitter.com/sonngoc">Son Ngoc</a>)<br>
                <a href="https://github.com/fe9lix/SAM-Swift">SAM-Swift</a> The SAM (State-Action-Model) pattern in Swift
                <a href="https://github.com/jdubray/sam-samples/tree/master/crud-blog-lambda">A simple CRUD application</a> running on AWS Lambda and DynamoDB for session management<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/react-counter">A simple counter</a> using React 15.0.2 with JSX/Babel<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/react-child-instance">A Parent/Child</a> sample using React 15.0.2 with JSX/Babel<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/vanilla-child-instance">Another Parent/Child</a> sample in vanilla.js<br>
                <a href="https://github.com/jdubray/sam-samples/blob/master/react-spinner/index.html">A CSS Spinner</a> using React/JSX without "looping" through the model<br>
                <a href="https://github.com/jdubray/sam-samples/tree/master/lit-html">SVG Clock</a> using the very promising <a href="https://github.com/PolymerLabs/lit-html">lit-html</a> library (Polymer Labs)<br>
                <a href="https://github.com/dshalkhakov/sam-csharp/tree/master/sam-csharp">Counter in C#</a> (Dmitry Shalkhakov)
                <a href="https://github.com/sirtimbly/frets#readme">FRETS - An Ultralight Composable Frontend TypeScript Web Framework</a> (Tim Bendt)
                <br><br>
          </p>
          </section>
          
          <section>
          <h2 id="frameworks">Frameworks</h2>
          <br>
          <p>André Statlz has written a great paper comparing the different <a href="http://staltz.com/unidirectional-user-interface-architectures.html">Unidirectional User Interface Architectures</a>. 
          The pattern closest to SAM is <a href="https://blog.famous.org/introducing-the-famous-framework/">Famous</a>, but unfortunately, they mutate the model directly from the actions (events in Famous' terms) and they do not support a nap() function.</p>
          <p>This <a href="https://www.youtube.com/watch?v=Pm0uwncSCo4&feature=youtu.be&t=14366">talk from Andrew Clark at the React 2016 Conference</a> offers some great perspective on the different approaches (React,Cycle,Elm) starting with a simple formula...: <pre>V = f( M )</pre></p>
          <br>
          <h4 id="react">React.js</h4>
          <br>
          <p>
            The SAM pattern spans several libraries of the React.js nebula: React.js itself, but also Flux/Redux, including separate libraries such as <a href="https://github.com/gaearon/redux-thunk">Redux-Thunk</a> and <a href="https://github.com/yelouafi/redux-saga">Redux-Saga</a>. 
            This framework (of libraries) has been built rather opportunistically, solving one problem at a time, without a coherent architecture. Further its architecture focuses heavily on the client, without much consideration for the server. 
          </p>
          <table class="table">
            <thead>
              <tr>
                <th><b>React + Redux + Thunks + Sagas</b></th>
                <th><b>SAM</b></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td width="50%">Single State Tree</td>
                <td width="50%">Single Model Tree</td>
              </tr>
              <tr>
                <td>State is read-only</td>
                <td>Model is presented with new proposed values</td>
              </tr>
              <tr>
                <td>Reducers are pure functions<br>Reducers have access to full scope of state when processing actions</td>
                <td>Actions are pure functions with respect to the model<br>Actions have no access to the model to compute the values presented to the model</td>
              </tr>
              <tr>
                <td>Store is updated with the output of the reducer function<br>
                Listeners are notified of the update
                </td>  
                <td>State Representation is created after the model has mutated<br>Next-Action Predicate evaluates whether an automatic action needs to be triggered</td>
              </tr>
              <tr>
                <td>View is a function of the state</td>
                <td>State representation is a function of the model</td>  
              </tr>
              <tr>
                <td>Next action predicate (nap) is implemented as a Saga which couples many operations and generally relies on local state as shown in <a href="https://gist.github.com/yelouafi/0385402a453b1fdb5cb0">this implementation of the Rocket Launcher</a>.</td>
                <td>The Next Action Predicate is a pure function of the model which computes the current (control) state of the system and derives the next-action.</td>  
              </tr>
            </tbody>
          </table>
          <br>
          <p>The main issues I see with this framework (as a set of libraries) are:</p>
          <ul><li>Redux combines the logic that computes the values with which you would update the model with the logic that decides whether the model accepts these values or not. </li>
          <li>As a corollary it couples the interface of the reducers to the model. One of the key roles of actions is to adapt the View-Model interface in ways that makes the model insensitive to the view semantics. The Reducers' interfaces are directly shapped by the view, which is an anti-pattern.</li>
          <li>Anemic actions are the default in Redux, you need to add the "thunk" library to be able to use functions as actions</li>
          <li>Sagas are stateful by definition and their imperative style makes it difficult to reason about what is the next action that will occur.</li>
          </ul><br>
          <p>That being said, the deal breaker, for me, is the fact that Reducers cannot run on the server because of React's architecture. 
          The store would need to be updated with the output of the root reducer, i.e. the entire state, which would create a high bandwidth, chatty interaction with the client.</p>
          <br>
          <h4 id="ng">Angular2</h4>
          <p>
              
          </p>
          <table class="table">
            <thead>
              <tr>
                <th><b>Angular2</b></th>
                <th><b>SAM</b></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td width="50%">Two-way Data Binding</td>
                <td width="50%">Functional HTML - V = f(M)</td>
              </tr>
              <tr>
                <td width="50%">Components as Classes (OOP)</td>
                <td width="50%">Functional building blocks (View, Action, State, NAP), in SAM only the Model is an Object</td>
              </tr>
              <tr>
                <td width="50%">Uncontrolled View updates with Change Detection</td>
                <td width="50%">SAM programming Step and Rendering are fully decoupled</td>
              </tr>
            </tbody>
          </table>
          <br>
          <p>With all its imperfections, boilerplate and template language, Angular makes it easy to implement the SAM pattern, which in turn, I believe, adds a lot of value to Angular with a Single State Tree and the ability to control mutations outside the Angular components. SAM allows you to code your business logic coupletely decoupled from Angular itself.</p>
          <p>For complex Angular components, I found it easier to create a local SAM implementation where all the state mutations are groupled in a single method and map event handlers to actions (which compute the proposal to mutate the application state)</p>
          <br>
          <h4 id="vue">Vue.js</h4>
          <p>
              <a href="https://vuejs.org/">Vue.js</a> is an <a href="https://medium.com/the-vue-point/vue-in-2016-8df71d98bfb3#.z4yfx9p6e">increasingly popular</a> framework for building modern Web applications. Just like React, the basic framework focuses (mostly) on the View and you need to select from another <a href="https://github.com/vuejs/vuex">nebula of libraries</a> when you need to build more robust applications. In this brief analysis, I will focus on vue.js only, as well as the <a href="https://github.com/vuejs/vuex">vuex.js</a> library which is a Redux-like state management library. Vue is template based and relies on two-way databinding which is a major step back in Front-End architectures. 
          </p>

          <table class="table">
            <thead>
              <tr>
                <th><b>Vue + Vuex</b></th>
                <th><b>SAM</b></th>
              </tr>
            </thead>
            <tbody>
                <tr>
                <td width="50%">Two-way Data Binding</td>
                <td width="50%">Functional HTML - V = f(M)</td>
              </tr>
              <tr>
                <td width="50%">Single State Tree</td>
                <td width="50%">Single Model Tree</td>
              </tr>
              <tr>
                <td>Two-Way Data Binding</td>
                <td>Model is presented with new proposed values</td>
              </tr>
              <tr>
                <td>Computed properties, Watches and Methods are free to assign new values to the model<br>In Vuex, </td>
                <td>Actions are pure functions with respect to the model<br>Actions have no access to the model to compute the values presented to the model</td>
              </tr>
              <tr>
                <td>Store is updated with the output of the reducer function<br>
                Listeners are notified of the update
                </td>  
                <td>State Representation is created after the model has mutated<br>Next-Action Predicate evaluates whether an automatic action needs to be triggered</td>
              </tr>
              <tr>
                <td>View is a function of the state</td>
                <td>State representation is a function of the model</td>  
              </tr>
              <tr>
                <td>Next action predicate (nap) is implemented as a Saga which couples many operations and generally relies on local state as shown in <a href="https://gist.github.com/yelouafi/0385402a453b1fdb5cb0">this implementation of the Rocket Launcher</a>.</td>
                <td>The Next Action Predicate is a pure function of the model which computes the current (control) state of the system and derives the next-action.</td>  
              </tr>
            </tbody>
          </table>
          <br>
          <h4 id="meiosis">Meiosis</h4>
          <p><a href="https://foxdonut.gitbooks.io/meiosis-guide/content/sam.html">Meiosis</a> is a library build by Fred Daoud that is well aligned with the SAM pattern. The library's core focus is to help organize the data flow of web applications. The general idea behind Meiosis is to start with a model and write a function that creates the view. When you want a looser coupling between the view and the model, you can optionally configure an "actions object" which translates view events into model proposals. Once the proposal is accepted by the model, Meiosis calls the view function with the updated model. You can also define a function to determine if another action should be automatically triggered, given the new application state. Meiosis is designed to work with plain JavaScript functions which, it wires together, without tying your code to the library. Last, but not least, you can switch from one Web framework to another and by changing the view code. The remainder of the code (the model, receiving proposals, actions, and so on) remains the same.</p>    
          <p>Here is a code <a href="https://github.com/foxdonut/meiosis-examples/tree/master/examples/sandbox/sam">sample</a> implementing the SAM pattern and using lit-html</p>
          </section>
          
          <section>
          <h2 id="references">Where can I find more information?</h2>
          <p>
              Jean-Jacques Dubray, <em>InfoQ</em>, Feb. 2016 "<a href="https://www.infoq.com/articles/no-more-mvc-frameworks">Why I no longer use MVC Frameworks?</a>"<br>
              Gunar Gessner, Jean-Jacques Dubray, <em>InfoQ</em>, Oct. 2016 "<a href="https://www.infoq.com/articles/sam-lessons-learned-front-end-reactive-architectures">Lessons learned in implementing the SAM pattern</a>"<br>
              Jean-Jacques Dubray, Marcus Feitoza, Sladan Ristic "<a href="Three Approximations You Should Never Use When Coding">Three Approximations You Should Never Use When Coding</a>"<br>
              Jean-Jacques Dubray "<a href="https://medium.com/@metapgmr/hex-a-no-framework-approach-to-building-modern-web-apps-e43f74190b9c">HEX: A no framework approach to building modern Web Applications</a>"<br>
              Alexander Schepanovski, March 2015 "<a href="http://hackflow.com/blog/2015/03/08/boiling-react-down-to-few-lines-in-jquery/">Boiling React Down to a Few Lines in jQuery</a>"<br>
              Simon Friis Vindum, "<a href="https://github.com/paldepind/functional-frontend-architecture">Functional Front-End Architectures</a>"<br>
              Tim Branyen, "<a href="https://github.com/tbranyen/diffhtml">DiffHTML</a>"<br>
              Steven Lambert, "<a href="https://github.com/straker/html-tagged-template">A proposal to improve the DOM creation API: HTML Tagged Templates</a>"<br>
              Mike Samuel, "<a href="https://js-quasis-libraries-and-repl.googlecode.com/svn/trunk/safetemplate.html#security_under_maintenance">Using type inference to make web templates robust against XSS</a>"<br>
              owasp.org "<a href="https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet">XSS (Cross Site Scripting) Prevention Cheat Sheet</a>"<br>
              Google <a href="https://www.google.com/about/appsecurity/learning/xss/">Application Security</a><br> 
              Greg Young, "<a href="https://www.youtube.com/watch?v=JHGkaShoyNs">CQRS and Event Sourcing</a>"<br>
              SmartDraw "<a href="https://blog.smartdraw.com/why-we-ditched-angular-js/">Why we ditched AngularJS</a>"
          </p>
          </section>
          
          <section>
          <!-- h2 id="who">Who is using SAM?</h2>
          <table class="table table-bordered table-striped table-info">
            <tbody>
              <tr>
                <td><a href="http://www.ebpml.org/about">ebpml.org</a></td>
                <td>The about page is built from an off-the-shelf template, the model populates itself with the ebpml.org RSS feed, the contact form invokes an action.</td>
              </tr>
              <tr>
                <td><a href="http://www.gliiph.com">Gliiph</a></td>
                <td>Gliiph is a new kind of Web platform that brings together content, data and APIs to deliver the next generation Web apps</td>
              </tr>
              <tr>
                <td><a href="http://www.michelduran.com">MichelDuran.com</a></td>
                <td>Michel Duran is a French-Canadian Actor, Director and Producer who recently engaged xgen.io to rebuild its Web site.</td>
              </tr>
            </tbody>
          </table -->
          </section>
          
        </article>
        <!-- END Main content -->
      </div>
    </main>


    <!-- Footer -->
    <footer class="site-footer">
      <div class="container-fluid">
        <a id="scroll-up" href="#"><i class="fa fa-angle-up"></i></a>

        <div class="row">
          <div class="col-md-6 col-sm-6">
            <p>Copyright &copy; 2016. xgen.io - all right reserved</p>
          </div>
          <div class="col-md-6 col-sm-6">
            <ul class="footer-menu">
              <li><a href="page_changelog.html">Changelog</a></li>
              <li><a href="page_credits.html">Credits</a></li>
              <li><a href="http://xgenio.com/contact-xgenio/">Contact us</a></li>
              <li><a href="http://shamsoft.net/thedocs/">Template by theDocs</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <!-- END Footer -->

    <!-- Scripts -->
    <script src="assets/js/theDocs.all.min.js"></script>
    <script src="assets/js/custom.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-36079112-2', 'auto');
        ga('send', 'pageview');

    </script>

    <script>
      ((window.gitter = {}).chat = {}).options = {
        room: 'jdubray/sam'
      };
    </script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

  </body>
</html>
