<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>SAM - State | Action | Model</title>

    <!-- Styles -->
    <link href="assets/css/theDocs.all.min.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">

    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Raleway:100,300,400,500%7CLato:300,400' rel='stylesheet' type='text/css'>

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="assets/img/favicon.ico">
  </head>

  <body>

    <header class="site-header">

      <!-- Top navbar & branding -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">

          <!-- Toggle buttons and brand -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar">
              <span class="glyphicon glyphicon-option-vertical"></span>
            </button>

            <button type="button" class="navbar-toggle for-sidebar" data-toggle="offcanvas">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="index.html"><img src="assets/img/logo.png" alt="logo"></a>
          </div>
          <!-- END Toggle buttons and brand -->

          <!-- Top navbar -->
          <div id="navbar" class="navbar-collapse collapse" aria-expanded="true" role="banner">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://gitter.im/jdubray/sam" target="_blank">Support</a></li>
              <li class="hero"><a href="http://xgenio.com/contact-xgenio/">Contact us</a></li>
              <li><a href="http://twitter.com/metapgmr"><i class="fa fa-twitter"></i></a></li>
              <li><a href="http://www.ebpml.org/blog15/feed/"><i class="fa fa-rss"></i></a></li>
            </ul>
          </div>
          <!-- END Top navbar -->

        </div>
      </nav>
      <!-- END Top navbar & branding -->
      
    </header>


    <main class="container-fluid">
      <div class="row">

        <!-- Sidebar -->
        <aside class="col-lg-2 col-md-3 col-sm-3 sidebar">

          <ul class="sidenav dropable sticky">
            <li><a href="#">Overview</a></li>
            <li>
              <a class="active" href="#">Topics</a>
              <ul>
                <li><a href="#actions">Actions</a></li>
                <li><a href="#model">Model</a></li>
                <li><a href="#state">State</a></li>
                <li><a href="#sr">State Representation</a></li>
                <li><a href="#wiring">Wiring</a></li>
                <li><a href="#timetravel">Time Travel</a></li>
              </ul>
            </li>
            
            <li>
              <a class="active" href="#">Advanced Topics</a>
              <ul>
                <li><a href="#comp">Composition</a></li>
                <li><a href="#sm">State Machines</a></li>
                <li><a href="#apis">APIs</a></li>
                <li><a href="#headless">Headless SAM</a></li>
                <li><a href="#conc">Concurrency</a></li>
              </ul>
            </li>

            <li>
              <a href="#samples">Code Samples</a>
              <ul>
                <li><a href="#rocket">Rocket Launcher</a></li>
                <li><a href="#rocketreact">SAM+Redux</a></li>
                <li><a href="#listsample">List Manager</a></li>
                <li><a href="#nodesample">Node.js</a></li>
              </ul>
            </li>

            <li>
              <a href="#">Frameworks</a>
              <ul>
                <li><a href="#react">React</a></li>
                <li><a href="#ng">Angular</a></li>
                <li><a href="#cycle">Cycle.js</a></li>
                <li><a href="#mithril">Mithril</a></li>
                <li><a href="#elm">Elm</a></li>
              </ul>
            </li>

            <li>
              <a href="#">News</a>
              <ul>
                <li><a href="http://www.infoq.com/articles/no-more-mvc-frameworks">Why I no longer use MVC Frameworks?</a></li>
              </ul>
            </li>
            <li><a href="#references">References</a></li>
            <li><a href="#who">Who is using SAM?</a></li>
          </ul>

        </aside>
        <!-- END Sidebar -->


        <!-- Main content -->
        <article class="col-lg-10 col-md-9 col-sm-9 main-content" role="main">
          
          <header>
            <h1>The SAM Pattern</h1>
            <p>SAM is a new reactive/functional pattern that simplifies Front-End architectures by clearly separating the business logic from the view and, in particular, strictly decoupling back-end APIs from the Front-End.
            SAM is technology independent and as such can be used to build Web Apps or Native Apps. It is also protocol independent and can be implemented over HTTP, WebSockets...</p>
            <p>SAM is unapologetically driven by simplicity and challenges the complexity of frameworks like Google's Angular or Facebook's React+JSX+Flux/Redux+Saga+Thunk+GraphQL+Relay. One of SAM's key goals is to enable everyone to build beautiful and engaging HTML5/CSS3/JavaScript Web Apps while retaining <a href="https://medium.com/@dan_abramov/youre-missing-the-point-of-react-a20e34a51e1a#.aoccyh29h">what makes React.js so unique</a>:</p>
            <ul><li>Composition</li><li>Unidirectional data flow</li><li>Freedom from DSLs</li><li>Explicit mutation</li><li>Static mental model </li></ul>
            <p>SAM is also challenging architecture patterns like <a href="http://samnewman.io/patterns/architectural/bff/">BFF</a> or the Vertical Slice Pattern which suggest creating view specific APIs, per platform, app, versions of an app...</p>
            <p>This new pattern was first introduced in an <a href="http://www.infoq.com/articles/no-more-mvc-frameworks">InfoQ article</a>, by <a href="www.ebpml.org/about">Jean-Jacques Dubray</a></p>
            
            <br>
            <ol class="toc">
              <li>
                <a href="#sam">How does SAM works?</a>
                <ol>
                  <li><a href="#vf">The View as a function of the Model</a></li>
                  <li><a href="#bl">Business Logic</a></li>
                </ol>
              </li>
              <li><a href="#getstarted">How can I get started?</a></li>
              <li><a href="#info">Where can I can find more information?</a></li>
              <li><a href="#using">Who is using SAM?</a></li>
            </ol>
          </header>

          <section>
            <h2 id="sam">How does SAM works?</h2>
            <p>SAM is a pattern that aims at replacing the MVC pattern. If you are already familiar with MVC, you should be able to make an easy transition to SAM.</p>
            <p>There are two main differences between MVC and SAM. First, SAM is reactive, while MVC is generally implemented in an interactive way. Some attempts have been made at implementing it in a reactive way, however, SAM is not just a reactive implementation of MVC. 
            Second, SAM introduces the concept of State as a mechanism to further decouple the View from the Model and treats the view merely as a "State Representation".</p>
            <br><br>
            <figure>
              <a = href="assets/figures/fig6.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig6.jpg" alt="the SAM pattern"/></a>
              <figcaption>The State-Action-Model (SAM) Pattern</figcaption>
            </figure>
                
                
            
            <h3 id="vf">The View as a Function of the Model</h4>
            <p>The best starting point to understand SAM is to understand the functional relationship between the view and the model. If you are familiar with React.js you probably noticed that one of the main goals of React's component model is to help you create the components' <code>render</code> function. 
            SAM suggests using the same approach and decomposing the view as a series of pure JavaScript functions. </p>
            <pre>V = f( M )</pre>
            <p>This concept is extremely simple to implement. I generally implement the front-end components as part of theme singleton:</p>
<div class="code-window"><pre><code class="language-markup">
var theme = {} ;

theme.ready = function(counter) {
    return (
           "&lt;p&gt;Counter:"+counter+"&lt;/p&gt;\n\
            &lt;form onSubmit=\"JavaScript:return actions.start({});\"&gt;\n\
                &lt;input type=\"submit\" value=\"Start\"&gt;\n\
            &lt;/form&gt;"
    ) ;
} 
</code></pre></div>
            <p>SAM forces front-end developers to think in terms of model, and no longer in terms of APIs: given the model property values, how does the View look like? How the values got there is irrelevant. This is the paradigm shift that React introduced.
               SAM does not always eliminate the need for interactions (request/responses), but it tends to keep a balance between reactive and interactive. This is probably the hardest thing to get in React and SAM, you have to try it for yourself.</p>
               <p>There is a fair amount of questions asking "why not use templates"? The reason is relatively simple, Templates are interpreters while functions are mini-code generators. Interpreters are limited in what they enable you to express (not to mention you often have to learn a specific syntax that does not translate at all to another interpreter). 
               On the other hand, code generators are infinitely flexible with hardly any drawbacks. I would personally choose functions over templates any day. Some people have mentioned the risks of cross-site-scripting when using raw JavaScript. 
               That is a very real risk and developers must always think about escaping their parameter values. Stateless React.js components are a perfectly good way to implement these functions, if you absolutely need a framework.</p>
            <p></p>
            <h3 id="bl">Business Logic</h4>
            <blockquote>A good Front-End Architecture should enable you to pin your modularized functions to the UI components in the most decoupled way possible. That way the technology backing the components can be swapped out and all your business logic is not in a hostage situation (at the mercy of the next great late framework) - Thomas J. Buhr </blockquote>
            <p>
            SAM's factoring of the business logic is based on <a href="http://research.microsoft.com/en-us/um/people/lamport/tla/tla.html">TLA+</a>:
            <blockquote>TLA+ is based on the idea that the best way to describe things formally is with simple mathematics, and that a specification language should contain as little as possible beyond what is needed to write simple mathematics precisely. TLA+ is especially well suited for writing high-level specifications of concurrent and distributed systems. - Dr. Leslie Lamport</blockquote>
            If you are interested in learning about TLA+, I found <a href="http://www.loria.fr/~merz/talks/argentina2005/slides.pdf">Stephan Merz's course</a> the most approachable introduction to TLA+.
            </p>
            <p>TLA+ is a formal specification which can be used describe, analyze and reason about systems, such as:</p>
            <ul>
                <li>sequential algorithms</li>
                <li>interactive systems</li>
                <li>reactive & distributed systems</li>
                <li>real-time & hybrid systems</li>
                <li>security-sensitive systems</li>
            </ul>
            <p>TLA+ offers a uniform language where transition system and properties represented as formulas, where Mathematics form the basis for description and analysis of reactive and distributed systems</p>
            <p>TLA defines two levels of syntax: action formulas and temporal formulas.</p>
               <ul><li>action formulas describe states and state transitions</li>
               <li>temporal formulas describe state sequences</li></ul>
            <p>TLA+ also includes concepts such as safety (something bad should never happen) and liveness (something good eventually happens).</p>
            <p>In SAM, the business logic is decomposed in three elements: Actions, the Model and the State.</p>
            <br>
            <h4 id="actions">Actions</h4>
            <p>
                Actions are pure functions which accept a dataset and return a dataset. The purpose of a function is to compute the values 
                we want the model to accept. There is nothing else to it.
                <a href="http://redux.js.org/docs/basics/Actions.html">In Redux for instance</a>, "actions" are closer to intent or event. This is a fundamental difference between Redux and SAM 
                because in Redux the reducer creates an unnecessary and unwanted coupling between the model mutations and the logic that translates intents into model property values.
<div class="code-window"><pre><code class="language-javascript">
    
    function action(data,present) {
    
        // compute the values we want the model to mutate to
        var data_ = the_actual_pure_function_implementing_the_action(data) ;
        
        // present these values to the model
        present(data_) ;
        
        // since we are in a reactive loop, the action returns nothing
    }
    
</code></pre></div>
                Actions are responsible for implementing context specific logic. If we take the example of a "change of address" action, we might  
                implement some context specific rules, such as when there is no country specified in the input dataset, the default country 
                is Australia, while the model is responsible for the integrity of a customer address which requires a country value. 
                In the context of SAM, actions play another important role with respect to invoking 3rd party APIs. For instance, we can define an action which 
                will invoke a 3rd party validation service, which given an address, returns the postal address (or an error). It is then 
                the postal address which is presented to the model. 
<div class="code-window"><pre><code class="language-javascript">
    
    function changeOfAddress(address,present) {
        
        address = address || {} ;
        address.country = address.country || 'Australia' ; 
        getPostalAddress( address, function(addr) {
            // assuming the dataset returned by the 3rd party
            // service can be directly presented to the model
            present(addr) ;
        }) ;
        
    }
    
</code></pre></div>
            </p>
            <p>Action logic can typically be reused across models, you can even think some companies will start offering SAM actions following a SaaS model. A "change of address" action, which returns a postal address given user data is highly reusable, across the enterprise. 
            </p>
            <br>
            <h4 id="model">Model</h4>
            <p>
            The model contains all the application state and (logically) exposes a single method: present(data). The model is responsible for accepting or rejecting the effects of an action. 
            The model where integrity rules get enforced. In other words, actions are generally triggered with some context specific data, they 
            do not have access to the application state, for instance, when you implement a "change password" action, the action will check
            if the password is valid in the context of the request, but the model might enforce additional integrity rules, such that you 
            cannot use a password that matches any of your last three passwords.
            </p>
            <p>The model is also solely responsible for the persistence of the application state.</p>
<div class="code-window"><pre><code class="language-javascript">
    
    model.present = function(data, render) {
        
        if (data.address !== undefined) {
            model.shippingAddress = data.address ;
            model.billingAddress = model.billingAddress || data.address ;
        }
        
        // trigger the state representation rendering
        render(model) ;
        
        // since we are in a reactive loop, the present method returns nothing
    }
    
</code></pre></div>
            
            <br>
            <h4 id="state">State</h4>
            <p>
            This concept is unique to SAM. Its purpose is to futher decouple the Model from the View (State Representation). The State has two roles: 
            <ul><li>Decide how to translate the model property values into a State Representation</li>
            <li>Process the next-action predicate</li>
            </ul>
            The State may compute the current "control state" of the system to decide how to render the view, but SAM does not require the State implementation to implement the semantics of a state machine. 
            In the Rocket Launcher example, we've have implemented the full semantics of a state machine where each control state is computed with pure functions such as:
<div class="code-window"><pre><code class="language-javascript">
// Assuming the following model structure
var model = {
        counter: COUNTER_MAX, 
        started: false,      
        launched: false, 
        aborted: false} ;
    
    
// Derive the current control states of the system
state.ready = function(model) {
    return ((model.counter === COUNTER_MAX) && !model.started && !model.launched && !model.aborted) ;
}

state.counting = function(model) {
    var status = ((model.counter <= COUNTER_MAX) && (model.counter >= 0) && model.started && !model.launched && !model.aborted) ;
    return status ;
}

state.render = function(model) {
    state.representation(model)
    state.nextAction(model) ;
}

state.representation = function(model, display) {
    var representation = 'oops... something went wrong, the system is in an invalid state' ;

    if (state.ready(model)) {
        representation = state.view.ready(model) ;
    } 

    if (state.counting(model)) {
        representation = state.view.counting(model) ;
    }

    if (state.launched(model)) {
        representation = state.view.launched(model) ;
    }

    if (state.aborted(model)) {
        representation = state.view.aborted(model) ;
    }

    // mount the corresponding representation in the GUI
    display(representation) ;
    
    // since we are in a reactive loop, the present method returns nothing
}
    
</code></pre></div>            
            </p>
            <p>Depending on the number of control states of your application and the size of your model, these functions can become rather tedious to write. Again, there is no requirement to adopt such an approach, it may help in some cases and be a burden in another where a series of if-then-else on some key properties of the model is good enough.</p>
            <p>Once the state representation is rendered, the State is responsible for invoking the next-action predicate (nap), which is a pure function of the model. The purpose of the nap() function is to determine if, given the current control state of the model, there are some automatic actions that need to be invoked. For instance in the <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample">Rocket Launcher</a> example, 
            the "decrement()" action is invoked by the next-action predicate while the system is in the counting state. When the counter reaches zero, it invokes the "launch()" action.
            </p>

<div class="code-window"><pre><code class="language-javascript">
state.nextAction = function (model) {
    if (state.counting(model)) {
        if (model.counter>0) {
            actions.decrement({counter: model.counter},model.present) ;
        }

        if (model.counter === 0) {
            actions.launch({},model.present) ;
        }
    }
}
</code></pre></div>   

            <br>
            <p>If you feel that a full state machine is required for your app, I'd recommend you use a library such as the <a href="https://bitbucket.org/jdubray/star-javascript">STAR library</a>.</p>
            <br>
            <h4 id="sr">State Representation</h4>
            <p>
            The State Representation function(s) are technology agnostic. SAM only requires that these functions be pure functions of the model (i.e. stateless from the model's perspective).    

<div class="code-window"><pre><code class="language-javascript">
// State representation of the counting state
view.counting = function(counter) {

    return (
            '&lt;p&gt;Count down:'+counter+'&lt;/p&gt;\n\
             &lt;form onSubmit="JavaScript:return actions.abort({});"&gt;\n\
                &lt;input type="submit" value="Abort"&gt;\n\
            &lt;/form&gt;'
        ) ;

}
</code></pre></div>   
            <br>
            Stateless React.js components would work great. The same type of function could we writen in Objective-C for the viewDidLoad method.<br><br> 
            Alex Schepanovski explains how to achieve <a href="http://hackflow.com/blog/2015/03/08/boiling-react-down-to-few-lines-in-jquery/">React.js functionality with just a few lines of JQuery</a>. 
            </p>
            <br>
            <h4 id="wiring">Wiring</h4>
            <p>
            The SAM pattern can be described as a Mathematical expression (formula):
            <pre>V = S( vm(M.present(A(data))), nap(Model) )</pre>
            Where S(), vm(), A() and nap() are pure functions with respect to the model.<br>
            However, that expression is only a logical expression that describes the sequence in which the elements of the pattern are invoked. The expression itself is not representative of the Reactive Flow or the different wiring options. 
            </p>
            <p>SAM can be implemented in the browser (<a href="http://andrewhfarmer.com/react-ajax-best-practices">like React and Redux</a>), but one of SAM's advantages is that the elements of the pattern can be distributed and composed in virtually any topology. 
            So there is not a single way to wire the pattern.</p>
            <p>You should also keep in mind that SAM is a reactive pattern so there is never a response that is expected: The view triggers an action, which presents is dataset to the model, which asks the state to create a state representation (i.e. View). The new state representation is just that, 
            a new view of the current state of the model. It is **not** a response to the original view.</p>
            <p>Let's start with a sample where running SAM exclusively in a single process (e.g. the browser, perhaps assuming the model will communicate with a persistent store).</p>
            <p>The model can be defined as a singleton, the actions as pure functions of a dataset, the state (stateRepresentation() and nap()) as a pure function of the model. Here is an example of wiring achieved with functional wrappers.</p>
<div class="code-window"><pre><code class="language-javascript">

// Model is a singleton /////////////////////////////////////////////
var model = {} ;

model.present = function(data) {
    // Logic that accepts or rejects the proposed values
    // ...
    
    // -> Reactive Loop
    state(model) ;
    
    // persist the new state
    // this is generally guarded and optimized
    model.persist() ;
} ;

model.persist = function() {

} ;

// Actions are pure functions /////////////////////////////////////////////  
function action1(data) {
    // Logic that prepares the data to be presented to the model
    // ...
    
    // -> Reactive Loop
    present(data) ;
    
    // to avoid a page reload
    return false ;
} 

function action2(data) {
    // Logic that prepares the data to be presented to the model
    // ...
    
    // -> Reactive Loop
    present(data) ;
    
    // to avoid a page reload
    return false ;
} 

// State is a pure function /////////////////////////////////////////////
function state(model) {

    // the state behavior is hard wired
    stateRepresentation(model) ;
    nap(model) ;
} 

function nap(model) {

    if (condition(model)) {
        var data = f(model) ;
        action2(data,model.present) ;
    }
}


// View is a pure function /////////////////////////////////////////////
function someView(model) {

    // render the view
    var output = '' ;
    // ...
    
    // wire the possible actions in the view
    output = output + 'onSubmit="JavaScript:return action1({data:data});'
    
    // ...
    // -> Reactive Loop
    display(output) ;
}



// Wiring /////////////////////////////////////////////
// 
// Actions are known to the stateRepresentation() and nap()
//
// Actions -> Model
function present(data) {

    model.present(data) ;

} 

// State -> View
function stateRepresentation(model) {

    someView(model) ;

} 


// View -> Display
function display(view) {

    var stateRepresentation = document.getElementById("view");
    stateRepresentation.innerHTML = view;

}


</code></pre></div>   
            <br><br>
            <p>Of course, JQuery event handlers could also be used:</p>
<div class="code-window"><pre><code class="language-markup">

...

&lt;input id="username" type="text" class="login-username" value="username"&gt;
&lt;input id="password" type="password" class="login-password" value="password"&gt;
&lt;button class="button button-green center-button" id="login"&gt;Login&lt;/button&gt;

...

&lt;script type="text/javascript"&gt;
$('#login').click(function() {
    var session = $.post( "http://authserver/v1/login", { username: $( "#username" ).val(), password:$( "#password" ).val() } ) ;
        session.done(function( data ) {
            var loginPanel = document.getElementById("login_panel") ;
            loginPanel.innerHTML = state.render(model.present(data)) ;
             ;
        })
}) ;
&lt;/script&gt;

... 

// another option is to implement the state, model and actions on the server:

&lt;script type="text/javascript"&gt;
$('#login').click(function() {
    var session = $.post( "http://authserver/v1/login", { username: $( "#username" ).val(), password:$( "#password" ).val() } ) ;
        session.done(function( stateRepresentation ) {
            var loginPanel = document.getElementById("login_panel") ;
            loginPanel.innerHTML = stateRepresentation ;
             ;
        })
}) ;
&lt;/script&gt;

</code></pre></div>   

<br>
<br>
            <p>One can also use <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/events.md">RxJS</a> to wire events to actions.</p>
<div class="code-window"><pre><code class="language-javascript">

var result = document.getElementById('submit');

var source = Rx.Observable.fromEvent(document, 'click');

var subscription = source.subscribe(function (e) {
  var data = { name: document.getElementById('name').value, ... } 
  result.innerHTML = state.render(model.present(data));
});
</code></pre></div>   

<br>
            <p>Wiring is an important concern when implementing the pattern. For instance, the <a href="https://medium.com/@mweststrate/pure-rendering-in-the-light-of-time-and-state-4b537d8d40b1#.q91pjr4c7">mobx framework</a> wires individual property value changes to the view rendering function, which is not representative of the behavior of the system and the processing of an action as a unit of work.
            As you can see in the example tab below, the view renders for state data changes:</p>
<br>
<div class="code-window">
    
    <pre><code class="language-javascript">
// The state of our app
var state = mobx.observable({
    nrOfSeats : 500,
    reservations : [],
    seatsLeft : function() { return this.nrOfSeats - this.reservations.length; }
});

// The UI; a function that is applied to the state
var ui = mobx.computed(function() {
    return "\n<div>Seats left: " + state.seatsLeft + 
        "<hr/>Attendees: " + state.reservations.join(", ") + "</div>";
});

// Make sure the UI is 'rendered' whenever it changes
ui.observe(function(newView) { console.log(newView) }, true);

// Put in some test data
state.reservations[0] = "Michel";
state.reservations.push("You?");
state.reservations[0] = "@mweststrate";
state.nrOfSeats = 750;
</code></pre>
<div class="code-preview"> 
&lt;div&gt;Seats left: 500&lt;hr/&gt;Attendees: &lt;/div&gt;<br>
&lt;div&gt;Seats left: 499&lt;hr/&gt;Attendees: Michel&lt;/div&gt;<br>
&lt;div&gt;Seats left: 498&lt;hr/&gt;Attendees: Michel, You?&lt;/div&gt;<br>
&lt;div&gt;Seats left: 498&lt;hr/&gt;Attendees: @mweststrate, You?&lt;/div&gt;<br>
&lt;div&gt;Seats left: 748&lt;hr/&gt;Attendees: @mweststrate, You?&lt;/div&gt;<br>
</div>
</div>
            <br>
            <br>
            <h4 id="timetravel">Time Travel</h4>
            <p>
                We are actively building a "Time Travel" like functionality for SAM that will work both on the client and server.
            </p>
            <br>
            <h4 id="comp">Composition</h4>
            <p>
            The SAM pattern offers some generous composition mechanisms.    
            </p>
            <p>First Actions, as pure functions, compose naturally to present a single dataset to the model:</p>
            <pre>C(data) = A(B(data))</pre>
            <p>This type of composition is a functional composition and the resulting action is considered to be a single action applied to the system from SAM's point of view.</p>
            <p>Similarly, the State Representation (View) can be decomposed in a hierarchy of components:</p>
<pre>
V = f( M )
f( M ) = f1( g1(M) + g2(M) ) + f2( h1(M) + h2(M) )
</pre>
            <br>
            <p>The most interesting composition mechanisms are at the pattern level itself. For instance, SAM supports an instance level composition where one instances runs in the browser and one instance runs in the server.</p>
            <a = href="assets/figures/fig9.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig9.jpg" alt=""/></a>
            <br>
<pre>
// The composition has a single view
V = Ss( Ms ) + Sc( Mc )

// Instance c (browser) invokes an action on instance s (server)
// this action is generally invoked in the nap() function of the client
V = Ss( Ms.present( As(Mc) )
</pre>            
<br>
<p>Though it is theoretically possible, it is highly recommended to refrain from invoking client actions from the server.
The role of the server is rather to deliver the SAM client instance as part of its state representation.
</p>
<p>NOTE: THIS IS JUST SOME INITIAL THOUGHTS, NEED MORE WORK:<br>SAM also offers an interesting alternative composition mechanism which enable to synchronize a client side and server side model, by which you present the same dataset to both the client side and server side model.</p>
<figure><a = href="assets/figures/fig11.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig11.jpg" alt="" width="370"/></a></figure>
            <br>
            <h4 id="sm">State Machines and Automatic Actions</h4>
            <blockquote>Computation is a major topic of computer science,<br>
                        and almost every object that computes is naturally viewed as a state machine.<br>
                        Yet computer scientists are so focused on the languages used to<br>
                        describe computation that they are largely unaware that those languages<br>
                        are all describing state machines - <a href="http://research.microsoft.com/en-us/um/people/lamport/pubs/state-machine.pdf">Dr. Leslie Lamport</a></blockquote>
            <p>
            SAM is particularly well aligned with the traditional semantics of State Machines except for one simple, yet fundamental difference. 
            Traditional State Machine semantics imply that the actions somehow connect two states, so State Machines are described as a series of tuples such as:
<pre>initialState = S<sub>0</sub>
(S<sub>0</sub>,A<sub>01</sub>,S<sub>1</sub>), (S<sub>1</sub>,A<sub>12</sub>,S<sub>2</sub>)...
</pre>
<br>
            This definition is somewhat of an approximation, it is not the action that decides the resulting state, it is the model, which, once the action has been applied (its value have been accepted, or not)
            that decides the resulting state: 
<pre>initialState = S<sub>0</sub> = S0( M0 ) 
(S<sub>0</sub>, A<sub>00</sub>, A<sub>01</sub>), (S<sub>1</sub>, A<sub>10</sub>, A<sub>11</sub>, A<sub>12</sub>)...
S<sub>0</sub> = S0( M )
S<sub>1</sub> = S1( M )
...
</pre><br>
            The tuplets (S<sub>i</sub>,A<sub>ik</sub>,S<sub>k</sub>) are merely an observation of the behavior of the state machine, rather than a physical representation of its runtime.<br> 
            This change of perspective (not semantics) is minute, yet fundamental. SAM would not work (as well) if the traditional semantics of State Machine would be structuring the code. 
            The SAM semantics are inclusive of this traditional structure, and therefore strictly compatible, but SAM by no means require that one uses a graph of State and Actions.
            </p>
            <p>I believe that is why some people have expressed that SAM "feels natural".</p>
            <p>The <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample">Rocket Launcher</a> example shows how to implement the Sx() functions:</p>

<div class="code-window"><pre><code class="language-javascript">
// Derive the current state of the system
state.ready = function(model) {
    return ((model.counter === COUNTER_MAX) && !model.started && !model.launched && !model.aborted) ;
}

state.counting = function(model) {
    var status = ((model.counter <= COUNTER_MAX) && (model.counter >= 0) && model.started && !model.launched && !model.aborted) ;
    return status ;
}

state.launched = function(model) {
    return ((model.counter == 0) && model.started && model.launched && !model.aborted) ;
}

state.aborted = function(model) {
    return (
        (  model.counter <= COUNTER_MAX) && (model.counter >= 0) 
        && model.started && !model.launched && model.aborted ) ;
}
</code></pre></div>   
            <br>
            <p>I cannot emphasize enough that it is not necessary to adopt a State Machine structure to use SAM and more often than not if-then-else will be adequate. However, sometimes it may become easier to use a strict State Machine structure.
            These functions can be used to validate that an action is enabled or not. They can also more naturally break down the hierarchy in from which the view is rendered.</p>
            
            <br>
            <h4 id="apis">APIs</h4>
            <p>
            SAM was originally designed to solve the strong coupling that MVC creates between the Front-End structure and the Back-End APIs. APIs can be composed at a couple levels in SAM:
            <ul>
                <li>Actions: for APIs with no side-effect whatsoever on the model</li>
                <li>Model: for CRUD APIs that persist/populate the model property values (commonly called the Data Access Layer)</li>
            </ul>
            Concurrency issues aside, an action can present its values when after processing an API call, for instance: 
            </p>
<div class="code-window"><pre><code class="language-javascript">
function getRssFeed(data) {
    
    var options = {
      url: 'http://www.ebpml.org/blog15/feed/',
      headers: {
        'accept': 'application/json'
      }
    };
    
    request(options, function (error, response, body) {
       if (!error && response.statusCode == 200) {
            
            // parse the RSS feed into a json object
            parseString(body, function (err, result) {
            
                // prepare proposed dataset
                data.blog = result.rss.channel[0].item ;
               
                // present data to the model
                present(data) ;
           });
       }
     });
}
</code></pre></div>   
            <br>
            <p>Similarly, the model can perform all the persistence operations (which could result in rejecting some proposed values) before passing control of the Reactive Loop to the State object.
            That is very different from React because you cannot touch the State without triggering a rendering of the view, which makes very little sense, when you think of it. It only makes sense when you spread the model state into 
            the various components, and even then it warps the articulation of APIs with the Front-End reactive Flow.
            </p>
            <br>
            <br>
            <h4 id="headless">Headless SAM</h4>
            <p>
            SAM can also be used without a View, whereby it listens on incoming Action requests and returns a response which can be the model of a fraction of the model. As such SAM offers a new API implementation pattern which is particularly well suited for implementating Stateful APIs. 
            </p>
            <br>
            <figure>
              <a = href="assets/figures/fig12.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig12.jpg" alt=""/></a>
            </figure>
            <br><br>
            <p>A node.js implementation of Headless SAM would look like this:</p>
<div class="code-window"><pre><code class="language-javascript">

var express = require('express');
var app = express();

//// Model ////////////////////////////

var S0 = { ... } ;

var present = (

    function (initialState) {
        var model = initialState ;
        return (function( data, res) {
        
            // mutate the model
            ...
        
            state(model) ;
        }) ;
    }
    
)(S0);


//// Actions ////////////////////////////

actions.addAPI('submit') ;
app.post(actions.apis.submit.path, function(req,res) {
    
    // extract intent from request body
    var intent = new Intent('submit',req.body) ;
    
    // Compute model property values
    data_ = actions.impl.submit(intent) ;
    
    // present data to the model
    presentToModel(data_, res) ; 
    
}) ;

//// State ////////////////////////////

function state(model) {
    
    // prepare and return API response
    var response = model.response() ;
    res.send(response) ;
    
    // execute next action predicate
    nap(model) ;

}

</code></pre></div> 
            <br>
            The pattern can easily be adapted to mount a user session in the model or rehydrate/dehydrate the context of the request before/after the model mutates.
            <br>
            <h4 id="conc">Concurrency</h4>
            <p>
                
            </p>
          </section>

          <section>
          <h2 id="getstarted">How can I get started?</h2>
          <p>We suggest that you download an HTML5 template of your choice and start building an application with it. To make this tutorial more realistic, we are going to build a simple Web Site with Blog and a Contact form.</p>
          <p>That <a href="http://html5up.net/zerofour">free template</a> seems like a great starting point. The list of components are easy to identify, from the index.html file:</p>
          <ul>
              <li>header</li>
              <li>banner</li>
              <li>heading</li>
              <li>services</li>
              <li>case studies</li>
              <li>blog (recent posts, and spotlight)</li>
              <li>filler links</li>
              <li>get in touch</li>
          </ul>
          <p>Many developers dislike the code that will follow, and for a reason that I still have difficulty to comprehend, they will prefer using React/JSX, Mithril or worse some templates. 
          Since this is a matter of preferences, there is not much point in arguing about it. I just happen to prefer a raw JavaScript/HTML5/CSS3 style. It is not just a style
          that would enable the greatest number of developers to become full stack developers (with Node.js), but it is a style that also enables the greatest 
          decoupling between the View and the Model. It is also a style that supports <a href="https://strongloop.com/strongblog/node-js-react-isomorphic-javascript-why-it-matters/">Isomorphic JavaScript</a> readily. 
          And perhaps, most practically, it allows anyone to take the work of a Web designer and turn it into a beautiful Web app in a matter of minutes. So let's go ahead and start creating the component interfaces without any apologies:</p> 

<div class="code-window">
              <!-- div class="code-preview">

              </div-->

<pre class="line-numbers"><code class="language-javascript">var theme = {} ;

theme.header = function( name, menu ) { } ;

theme.banner = function( title, tagLine, buttonLink, buttonLabel ) { } ;

theme.heading = function( title, tagLine) { } ;

theme.services = function( serviceList ) { } ;

theme.description = function( text ) { } ;

theme.caseStudies = function(   title1, tagLine1, description1, link1, button1, icon1, 
                                title2, tagLine2, description2, link2, button2, icon2  ) {  } ;

theme.blog = function( posts, title, tagLine, description ) { } ;

theme.footer = function( fillers ) { } ;

theme.contact = function( title, description, learnMoreLink, socialLinks, address, phone, email ) { } ;
</code></pre>
            </div>
            <p>The implementation of each function is just a parameterization of the HTML template:</p>
            <div class="code-window">
                          <!-- div class="code-preview">
            
                          </div-->
            
<pre class="line-numbers"><code class="language-javascript">theme.caseStudies = function( title1, tagLine1, description1, link1, button1, icon1, 
                              title2, tagLine2, description2, link2, button2, icon2  ) { 
    icon1 = icon1 || 'arrow-circle-right' ;
    icon2 = icon2 || 'info-circle' ;
    return (
    '&lt;div class="wrapper style2"&gt;\n\
        &lt;div class="inner"&gt;\n\
            &lt;!-- Feature 2 --&gt;\n\
                &lt;section class="container box feature2"&gt;\n\
                    &lt;div class="row"&gt;\n\
                        &lt;div class="6u 12u(mobile)"&gt;\n\
                            &lt;section&gt;\n\
                                &lt;header class="major"&gt;\n\
                                    &lt;h2&gt;'+title1+'&lt;/h2&gt;\n\
                                    &lt;p&gt;'+tagLine1+'&lt;/p&gt;\n\
                                &lt;/header&gt;\n\
                                &lt;p&gt;'+description1+'&lt;/p&gt;\n\
                                &lt;footer&gt;\n\
                                    &lt;a href="'+link1+'" class="button medium icon fa-'+icon1+'"&gt;'+button1+'&lt;/a&gt;\n\
                                &lt;/footer&gt;\n\
                            &lt;/section&gt;\n\
                        &lt;/div&gt;\n\
                        &lt;div class="6u 12u(mobile)"&gt;\n\
                            &lt;section&gt;
                                &lt;header class="major"&gt;\n\
                                    &lt;h2&gt;'+title2+'&lt;/h2&gt;\n\
                                    &lt;p&gt;'+tagLine2+'&lt;/p&gt;\n\
                                &lt;/header&gt;\n\
                                &lt;p&gt;'+description2+'&lt;/p&gt;\n\
                                &lt;footer&gt;\n\
                                    &lt;a href="'+link2+'" class="button medium alt icon fa-'+icon2+'"&gt;'+button2+'&lt;/a&gt;\n\
                                &lt;/footer&gt;\n\
                            &lt;/section&gt;\n\
                        &lt;/div&gt;\n\
                    &lt;/div&gt;\n\
                &lt;/section&gt;\n\
            &lt;/div&gt;\n\
    &lt;/div&gt;\n'
    ) ;
} ;

</code></pre>
                    </div>
            
          </section>
          
          <section>
          <h2 id="samples">Code Samples</h2>
          <p>
                <a href="https://bitbucket.org/snippets/jdubray/9dgKp/sam-sample" id="rocket">Rocket Launcher sample (Browser only, HTML+JavaScript)</a> You can run that sample <a href="https://bb.githack.com/!api/2.0/snippets/jdubray/9dgKp/a1dd9b8b9f241600ad108ef741845241c31c9fce/files/rocket.html">here</a> (courtesy of <a href="https://twitter.com/jose_pedro_dias"> Jose Pedro Dias</a>)<br>
                <a href="http://codepen.io/foxdonut/pen/XXPwRe">Rocket Launcher with Cycle.js</a> (<a href="http://www.linkedin.com/in/fredericdaoud">Fred Daoud</a>)<br>
                <a href="https://github.com/JosePedroDias/sam_rocket_w_snabbdom">Rocket Launcher sample with Snabbdom</a> (<a href="https://twitter.com/jose_pedro_dias"> Jose Pedro Dias</a>). You can run the sample <a href="https://josepedrodias.github.io/sam_rocket_w_snabbdom/index.html">here</a>.<br>
                <a href="https://jsfiddle.net/80xzt848/1/">Rocket Launcher sample with Knockout.js</a> (<a href="http://blog.troyingram.us/">Troy Ingram</a>)<br>
                <a href="https://github.com/gunar/sam-redux" id="rocketreact">React+Redux Rocket Launcher sample (following the SAM pattern)</a> (<a href="https://twitter.com/gunar">Gunar Gessner)</a><br>
                <a href="https://bitbucket.org/snippets/jdubray/zr9r6/item-list" id="listsample">List Manager (Browser only, HTML+JavaScript)</a><br>
                <a herf="http://codepen.io/msolovyov/pen/qbvYpv?editors=1010">List Manager (Browser only, Vue.js)</a> (<a href="">Michael Solovyov</a>)<br>
                <a href="https://bitbucket.org/snippets/jdubray/jna7B/sam-sample-app-on-nodejs" id="nodesample">Simple Web site with Contact App (Node.js+HTML)</a><br>
          </p>
          <p>This is what Jonathan Siu, Startup Consultant, had to say about SAM:</p><br>
          <figure>
            <a = href="assets/figures/fig0.jpg"><img class="img-shadow img-responsive center-block" src="assets/figures/fig0.jpg" alt=""/></a>
          </figure>
          </section>
          
          <section>
          <h2 id="frameworks">Frameworks</h2>
          <br>
          <p>Andr√© Statlz has written a great paper comparing the different <a href="http://staltz.com/unidirectional-user-interface-architectures.html">Unidirectional User Interface Architectures</a>. 
          The pattern closest to SAM is <a href="https://blog.famous.org/introducing-the-famous-framework/">Famous</a>, but unfortunately, they mutate the model directly from the actions (events in Famous' terms) and they do not support a nap() function.</p>
          <p>This <a href="https://www.youtube.com/watch?v=Pm0uwncSCo4&feature=youtu.be&t=14366">talk from Andrew Clark at the React 2016 Conference</a> offers some great perspective on the different approaches (React,Cycle,Elm) starting with a simple formula...: <pre>V = f( M )</pre></p>
          <br>
          <h4 id="react">React.js</h4>
          <br>
          <p>
            The SAM pattern spans several libraries of the React.js nebula: React.js itself, but also Flux/Redux, including separate libraries such as <a href="https://github.com/gaearon/redux-thunk">Redux-Thunk</a> and <a href="https://github.com/yelouafi/redux-saga">Redux-Saga</a>. 
            This framework (of libraries) has been built rather opportunistically, solving one problem at a time, without a coherent architecture. Further its architecture focuses heavily on the client, without much consideration for the server. 
          </p>
          <table class="table">
            <thead>
              <tr>
                <th><b>React + Redux + Thunks + Sagas</b></th>
                <th><b>SAM</b></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td width="50%">Single State Tree</td>
                <td width="50%">Single Model Tree</td>
              </tr>
              <tr>
                <td>State is read-only</td>
                <td>Model is presented with new proposed values</td>
              </tr>
              <tr>
                <td>Reducers are pure fonctions<br>Reducers have access to full scope of state when processing actions</td>
                <td>Actions are pure functions with respect to the model<br>Actions have no access to the model to compute the values presented to the model</td>
              </tr>
              <tr>
                <td>Store is updated with the output of the reducer fonction<br>
                Listeners are notified of the update
                </td>  
                <td>State Representation is created after the model has mutated<br>Next-Action Predicate evaluates whether an automatic action needs to be triggered</td>
              </tr>
              <tr>
                <td>View is a function of the state</td>
                <td>State representation is a function of the model</td>  
              </tr>
              <tr>
                <td>Next action predicate (nap) is implemented as a Saga which couples many operations and generally relies on local state as shown in <a href="https://gist.github.com/yelouafi/0385402a453b1fdb5cb0">this implementation of the Rocket Launcher</a>.</td>
                <td>The Next Action Predicate is a pure function of the model which computes the current (control) state of the system and derives the next-action.</td>  
              </tr>
            </tbody>
          </table>
          <br>
          <p>The main issues I see with this framework (as a set of libraries) are:</p>
          <ul><li>Redux combines the logic that computes the values with which you would update the model with the logic that decides whether the model accepts these values or not. </li>
          <li>As a corollary it couples the interface of the reducers to the model. One of the key roles of actions is to adapt the View-Model interface in ways that makes the model insensitive to the view semantics. The Reducers' interfaces are directly shapped by the view, which is an anti-pattern.</li>
          <li>Anemic actions are the default in Redux, you need to add the "thunk" library to be able to use functions as actions</li>
          <li>Sagas are stateful by definition and their imperative style makes it difficult to reason about what is the next action that will occur.</li>
          </ul><br>
          <p>That being said, the deal breaker, for me, is the fact that Reducers cannot run on the server because of React's architecture. 
          The store would need to be updated with the output of the root reducer, i.e. the entire state, which would create a high bandwidth, chatty interaction with the client.</p>
          <br>
          <h4 id="ng">Angular</h4>
          <p>
              
          </p>
          <br>
          <h4 id="cycle">Cycle.js</h4>
          <p>
              
          </p>
          <br>
          <h4 id="mithril">Mithril</h4>
          <p>
              
          </p>
          <br>
          <h4 id="elm">Elm</h4>
          <p>
              
          </p>
          </section>
          
          <section>
          <h2 id="references">Where can I find more information?</h2>
          <p>
              Jean-Jacques Dubray, <em>InfoQ</em>, Feb. 2016 "<a href="www.infoq.com/articles/no-more-mvc-frameworks">Why I no longer use MVC Frameworks?</a>"<br>
              Alexander Schepanovski, March 2015 "<a href="http://hackflow.com/blog/2015/03/08/boiling-react-down-to-few-lines-in-jquery/">Boiling React Down to a Few Lines in jQuery</a>"<br>
              Simon Friis Vindum, "<a href="https://github.com/paldepind/functional-frontend-architecture">Functionl Front-End Architectures</a>"<br>
              Tim Branyen, "<a href="https://github.com/tbranyen/diffhtml">DiffHTML</a>"<br>
              Steven Lambert, "<a href="https://github.com/straker/html-tagged-template">A proposal to improve the DOM creation API: HTML Tagged Templates</a>"<br>
              Mike Samuel, "<a href="https://js-quasis-libraries-and-repl.googlecode.com/svn/trunk/safetemplate.html#security_under_maintenance">Using type inference to make web templates robust against XSS</a>"<br>
          </p>
          </section>
          
          <section>
          <h2 id="who">Who is using SAM?</h2>
          <table class="table table-bordered table-striped table-info">
            <tbody>
              <tr>
                <td><a href="http://www.ebpml.org/about">ebpml.org</a></td>
                <td>The about page is built from an off-the-shelf template, the model populates itself with the ebpml.org RSS feed, the contact form invokes an action.</td>
              </tr>
              <tr>
                <td><a href="http://www.gliiph.com">Gliiph</a></td>
                <td>Gliiph is a new kind of Web platform that brings together content, data and APIs to deliver the next generation Web apps</td>
              </tr>
              <tr>
                <td><a href="http://www.michelduran.com">MichelDuran.com</a></td>
                <td>Michel Duran is a French-Canadian Actor, Director and Producer who recently engaged xgen.io to rebuild its Web site.</td>
              </tr>
            </tbody>
          </table>
          </section>
          
        </article>
        <!-- END Main content -->
      </div>
    </main>


    <!-- Footer -->
    <footer class="site-footer">
      <div class="container-fluid">
        <a id="scroll-up" href="#"><i class="fa fa-angle-up"></i></a>

        <div class="row">
          <div class="col-md-6 col-sm-6">
            <p>Copyright &copy; 2016. xgen.io - all right reserved</p>
          </div>
          <div class="col-md-6 col-sm-6">
            <ul class="footer-menu">
              <li><a href="page_changelog.html">Changelog</a></li>
              <li><a href="page_credits.html">Credits</a></li>
              <li><a href="http://xgenio.com/contact-xgenio/">Contact us</a></li>
              <li><a href="http://shamsoft.net/thedocs/">Template by theDocs</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <!-- END Footer -->

    <!-- Scripts -->
    <script src="assets/js/theDocs.all.min.js"></script>
    <script src="assets/js/custom.js"></script>

  </body>
</html>
